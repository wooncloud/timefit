-- ============================================================
-- ì˜ì—…ì‹œê°„ ì„¤ì •
-- ============================================================
-- API:        PUT /api/business/{id}/operating-hours
-- í•µì‹¬ ì¿¼ë¦¬:  INSERT INTO operating_hours (ì—¬ëŸ¬ ê±´)
-- ì‚¬ì „ì¡°ê±´:   _setup.sql (User, Business)
-- ============================================================

BEGIN;

-- ============================================================
-- ğŸ”§ í”½ìŠ¤ì²˜
-- ============================================================
-- ì—†ìŒ (ì„¤ì • ìì²´ê°€ ì¸¡ì • ëŒ€ìƒ)

-- ============================================================
-- ğŸ” EXPLAIN: ì˜ì—…ì‹œê°„ ì„¤ì • (ì›”~ê¸ˆ: 09-18, í† ~ì¼: 09-14)
-- ============================================================

-- í‰ì¼ ì„¤ì • (ì›”~ê¸ˆ, day_of_week 0-4)
EXPLAIN (ANALYZE, BUFFERS)
INSERT INTO operating_hours (
    id,
    business_id,
    day_of_week,
    open_time,
    close_time,
    is_closed,
    sequence,
    created_at,
    updated_at
)
SELECT 
    gen_random_uuid(),
    '99999999-0000-0000-0000-000000000100',
    day_num,
    '09:00:00'::time,
    '18:00:00'::time,
    false,
    0,
    NOW(),
    NOW()
FROM generate_series(0, 4) AS day_num;

-- ============================================================
-- ğŸ’¡ í™•ì¸ í¬ì¸íŠ¸
-- ============================================================
-- âœ… INSERT ê¸°ë³¸ cost (5ê±´ ì¼ê´„ ì‚½ì…)
-- âœ… FK ì œì•½ í™•ì¸ ë¹„ìš©
--    - business_id â†’ business í…Œì´ë¸” ì°¸ì¡° í™•ì¸
-- âœ… ì¸ë±ìŠ¤ ìƒì„± ë¹„ìš©
--    - PK ì¸ë±ìŠ¤ + FK ì¸ë±ìŠ¤
--    - 5ê±´ì´ë¯€ë¡œ ì¸ë±ìŠ¤ ê°±ì‹  5ë²ˆ
-- âœ… Buffers: shared hit vs dirtied
--    - ì—¬ëŸ¬ ê±´ INSERTì´ë¯€ë¡œ dirtied ì¦ê°€
--
-- ì°¸ê³ : ì‹¤ì œ APIëŠ” ë” ë³µì¡
--       - ê¸°ì¡´ ì˜ì—…ì‹œê°„ ì‚­ì œ (DELETE WHERE business_id)
--       - ìƒˆ ì˜ì—…ì‹œê°„ ì‚½ì… (ì—¬ëŸ¬ INSERT)
--       - íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬
--       ì´ íŒŒì¼ì€ INSERT ë¶€ë¶„ë§Œ ì¸¡ì •

ROLLBACK;
