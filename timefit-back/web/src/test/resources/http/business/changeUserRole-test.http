### 구성원 권한 변경 API 테스트

### 1. OWNER 사용자 회원가입
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "role-owner@timefit.com",
  "password": "SecureP@ss123!",
  "name": "권사장",
  "phoneNumber": "010-1111-2222"
}
> {%
    const authHeader = response.headers.valueOf("Authorization");
    client.global.set("ownerAuthHeader", authHeader);
    console.log("OWNER 회원가입 성공");
%}

### 2. OWNER 업체 생성
POST http://localhost:8080/api/business
Content-Type: application/json
Authorization: {{ownerAuthHeader}}

{
  "businessName": "권한 테스트 회사",
  "businessType": "IT",
  "businessNumber": "500-50-50505",
  "address": "서울시 강남구 권한로 500",
  "contactPhone": "02-5050-5050",
  "description": "구성원 권한 변경 테스트용 회사입니다"
}
> {%
    if (response.body.data) {
        const businessId = response.body.data.businessId;
        client.global.set("businessId", businessId);
        console.log("업체 생성 성공, ID:", businessId);
    }
%}

### 3. MANAGER 사용자 회원가입
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "role-manager@timefit.com",
  "password": "SecureP@ss123!",
  "name": "매니저권한",
  "phoneNumber": "010-2222-3333"
}
> {%
    console.log("MANAGER 회원가입 성공");
%}

### 4. MEMBER 사용자 회원가입
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "role-member@timefit.com",
  "password": "SecureP@ss123!",
  "name": "멤버권한",
  "phoneNumber": "010-3333-4444"
}
> {%
    console.log("MEMBER 회원가입 성공");
%}

### 5. MANAGER 초대
POST http://localhost:8080/api/business/{{businessId}}/members/invite
Content-Type: application/json
Authorization: {{ownerAuthHeader}}

{
  "email": "role-manager@timefit.com",
  "role": "MANAGER",
  "invitationMessage": "매니저로 초대합니다"
}
> {%
    if (response.body.data) {
        client.global.set("managerUserId", response.body.data.userId);
        console.log("MANAGER 초대 성공, ID:", response.body.data.userId);
    }
%}

### 6. MEMBER 초대
POST http://localhost:8080/api/business/{{businessId}}/members/invite
Content-Type: application/json
Authorization: {{ownerAuthHeader}}

{
  "email": "role-member@timefit.com",
  "role": "MEMBER",
  "invitationMessage": "멤버로 초대합니다"
}
> {%
    if (response.body.data) {
        client.global.set("memberUserId", response.body.data.userId);
        console.log("MEMBER 초대 성공, ID:", response.body.data.userId);
    }
%}

### 7. 초대 후 구성원 목록 확인
GET http://localhost:8080/api/business/{{businessId}}/members
Authorization: {{ownerAuthHeader}}

> {%
    console.log("=== 권한 변경 전 구성원 목록 ===");
    if (response.body.data) {
        response.body.data.forEach((member, index) => {
            console.log(`${index + 1}. ${member.name} - ${member.role}`);
        });
    }
%}

### 8. 권한 변경 성공 - MEMBER → MANAGER
PATCH http://localhost:8080/api/business/{{businessId}}/members/{{memberUserId}}/role
Content-Type: application/json
Authorization: {{ownerAuthHeader}}

{
  "newRole": "MANAGER"
}
> {%
    console.log("MEMBER → MANAGER 변경 응답:", response.status);
    if (response.status === 200) {
        console.log("✅ MEMBER → MANAGER 권한 변경 성공");
    }
%}

### 9. 권한 변경 성공 - MANAGER → MEMBER
PATCH http://localhost:8080/api/business/{{businessId}}/members/{{managerUserId}}/role
Content-Type: application/json
Authorization: {{ownerAuthHeader}}

{
  "newRole": "MEMBER"
}
> {%
    console.log("MANAGER → MEMBER 변경 응답:", response.status);
    if (response.status === 200) {
        console.log("✅ MANAGER → MEMBER 권한 변경 성공");
    }
%}

### 10. 권한 변경 후 구성원 목록 확인
GET http://localhost:8080/api/business/{{businessId}}/members
Authorization: {{ownerAuthHeader}}

> {%
    console.log("=== 권한 변경 후 구성원 목록 ===");
    if (response.body.data) {
        response.body.data.forEach((member, index) => {
            console.log(`${index + 1}. ${member.name} - ${member.role}`);
        });
    }
%}

### 11. 실패 케이스 - OWNER 권한으로 변경 시도
PATCH http://localhost:8080/api/business/{{businessId}}/members/{{memberUserId}}/role
Content-Type: application/json
Authorization: {{ownerAuthHeader}}

{
  "newRole": "OWNER"
}
> {%
    console.log("OWNER 권한 변경 시도 응답:", response.status);
    if (response.status === 400) {
        console.log("✅ OWNER 권한 변경 차단 성공");
        console.log("에러:", response.body.error?.code);
    }
%}

### 12. MANAGER 로그인 (권한 테스트용)
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "role-manager@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const managerAuthHeader = response.headers.valueOf("Authorization");
    client.global.set("managerAuthHeader", managerAuthHeader);
    console.log("MANAGER 로그인 성공");
%}

### 13. 실패 케이스 - MANAGER가 권한 변경 시도
PATCH http://localhost:8080/api/business/{{businessId}}/members/{{memberUserId}}/role
Content-Type: application/json
Authorization: {{managerAuthHeader}}

{
  "newRole": "MANAGER"
}
> {%
    console.log("MANAGER 권한 변경 시도 응답:", response.status);
    if (response.status === 403) {
        console.log("✅ MANAGER 권한 변경 차단 성공");
        console.log("에러:", response.body.error?.code);
    }
%}

### 14. 실패 케이스 - 존재하지 않는 사용자 권한 변경
PATCH http://localhost:8080/api/business/{{businessId}}/members/00000000-0000-0000-0000-000000000000/role
Content-Type: application/json
Authorization: {{ownerAuthHeader}}

{
  "newRole": "MANAGER"
}
> {%
    console.log("존재하지 않는 사용자 권한 변경 응답:", response.status);
    if (response.status === 404) {
        console.log("✅ 존재하지 않는 사용자 권한 변경 차단 성공");
        console.log("에러:", response.body.error?.code);
    }
%}

### 15. 최종 구성원 목록 및 권한 확인
GET http://localhost:8080/api/business/{{businessId}}/members
Authorization: {{ownerAuthHeader}}

> {%
    console.log("=== 최종 구성원 목록 ===");
    if (response.body.data) {
        response.body.data.forEach((member, index) => {
            console.log(`${index + 1}. ${member.name} - ${member.role} (활성: ${member.isActive})`);
        });

        const roleCount = response.body.data.reduce((acc, member) => {
            acc[member.role] = (acc[member.role] || 0) + 1;
            return acc;
        }, {});

        console.log("권한별 구성원 수:", roleCount);
        console.log("총 구성원 수:", response.body.data.length);
    }
%}