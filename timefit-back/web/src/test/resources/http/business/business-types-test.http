### businessTypes 테스트 - 단일 업종에서 복합 업종으로 확장 (서비스 등록시 자동 변경 X)

### 1. 회원가입 (업체 없이 사용자만 생성)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "multibiz@test.com",
  "password": "Test1234!",
  "name": "복합업종사장",
  "phoneNumber": "010-1234-5678"
}

> {%
    client.test("회원가입 성공", function() {
        client.assert(response.status === 201, "응답 코드가 201이어야 함");
        client.assert(response.headers.valueOf("Authorization"), "Authorization 헤더가 있어야 함");
        client.assert(response.body.data.accessToken, "accessToken이 응답에 있어야 함");
    });

    const authHeader = response.headers.valueOf("Authorization");
    const accessToken = response.body.data.accessToken;
    client.global.set("authHeader", authHeader);
    client.global.set("accessToken", accessToken);
    console.log("✅ 회원가입 성공 - Authorization:", authHeader?.substring(0, 30) + "...");
%}

### 2. 로그인
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "multibiz@test.com",
  "password": "Test1234!"
}

> {%
    client.test("로그인 성공", function() {
        client.assert(response.status === 200, "응답 코드가 200이어야 함");
        client.assert(response.headers.valueOf("Authorization"), "Authorization 헤더가 있어야 함");
        client.assert(response.body.data.accessToken, "accessToken이 응답에 있어야 함");
    });

    const authHeader = response.headers.valueOf("Authorization");
    const accessToken = response.body.data.accessToken;
    client.global.set("authHeader", authHeader);
    client.global.set("accessToken", accessToken);
    console.log("✅ 로그인 성공 - Authorization:", authHeader?.substring(0, 30) + "...");
    console.log("로그인 사용자 정보:", response.body.data.name, response.body.data.email);
%}

### 3. JWT 토큰 유효성 확인 (선택사항)
GET http://localhost:8080/api/auth/status-test
Authorization: {{authHeader}}

> {%
    console.log("=== JWT 토큰 유효성 테스트 ===");
    console.log("Status:", response.status);
    console.log("Response:", JSON.stringify(response.body, null, 2));

    if (response.status !== 200) {
        console.log("❌ 토큰 검증 실패!");
    } else {
        console.log("✅ 토큰 검증 성공!");
    }
%}

### 4. 업체 생성 - 처음엔 단일 업종만 (BD000: 음식점업)
POST http://localhost:8080/api/business
Content-Type: application/json
Authorization: {{authHeader}}

{
  "businessName": "작은 카페",
  "businessTypes": ["BD000"],
  "businessNumber": "999-88-77777",
  "address": "서울시 강남구 카페로 123",
  "contactPhone": "02-9999-8888",
  "description": "음식점으로 시작한 작은 카페입니다"
}

> {%
    console.log("업체 생성 응답 상태:", response.status);
    console.log("업체 생성 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("✅ 업체 생성 성공");
        console.log("   - 생성된 업체 ID:", response.body.data.businessId);
        console.log("   - 업체명:", response.body.data.businessName);
        console.log("   - 업종:", response.body.data.businessTypes);
        console.log("   - 업종 개수:", response.body.data.businessTypes.length);
        console.log("   - 내 권한:", response.body.data.myRole);
        client.global.set("businessId", response.body.data.businessId);
    }
%}

### 5. 내 업체 목록 조회 (단일 업종 확인)
GET http://localhost:8080/api/business
Authorization: {{authHeader}}

> {%
    console.log("업체 목록 조회 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        const business = response.body.data[0];
        console.log("✅ 현재 업체 정보:");
        console.log("   - 업체명:", business.businessName);
        console.log("   - 업종:", business.businessTypes);
        console.log("   - 업종 개수:", business.businessTypes.length);
        console.log("   - 내 권한:", business.myRole);
    }
%}

### 6. 업체 정보 수정 - 복합 업종으로 확장 (음식점 + 미용 + 교육)
PUT http://localhost:8080/api/business/{{businessId}}
Content-Type: application/json
Authorization: {{authHeader}}

{
  "businessName": "복합문화공간",
  "businessTypes": ["BD000", "BD003", "BD006"],
  "address": "서울시 강남구 복합로 456",
  "contactPhone": "02-1111-2222",
  "description": "음식점, 미용실, 문화센터를 결합한 복합공간으로 확장했습니다",
  "logoUrl": null
}

> {%
    console.log("업종 확장 응답 상태:", response.status);
    console.log("업종 확장 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("✅ 업종 확장 성공:");
        console.log("   - 이전: [BD000]");
        console.log("   - 현재:", response.body.data.businessTypes);
        console.log("   - 변경된 업체명:", response.body.data.businessName);
    }
%}

### 7. 업체 상세 조회 (복합 업종 확인)
GET http://localhost:8080/api/business/{{businessId}}
Authorization: {{authHeader}}

> {%
    console.log("업체 상세 조회 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("✅ 최종 업체 정보:");
        console.log("   - 업체명:", response.body.data.businessName);
        console.log("   - 업종:", response.body.data.businessTypes);
        console.log("   - 업종 개수:", response.body.data.businessTypes.length);
        console.log("   - 설명:", response.body.data.description);
        console.log("   - 총 구성원 수:", response.body.data.totalMembers);
    }
%}

### 8. 업체 검색 - 특정 업종으로 검색 (BD003: 미용/뷰티업)
GET http://localhost:8080/api/business/search?businessType=BD003

> {%
    console.log("BD003(미용/뷰티업) 검색 응답:", JSON.stringify(response.body, null, 2));

    console.log("✅ BD003(미용/뷰티업) 검색 결과:");
    console.log("   - 검색된 업체 수:", response.body.data.businesses.length);
    console.log("   - 총 검색 결과:", response.body.data.totalElements);

    if (response.body.data.businesses.length > 0) {
        const found = response.body.data.businesses.find(b => b.businessId === client.global.get("businessId"));
        if (found) {
            console.log("   ✅ 내 업체가 검색됨:");
            console.log("      - 업체명:", found.businessName);
            console.log("      - 업종:", found.businessTypes);
        }
    }
%}

### 9. 업체 검색 - 다른 업종으로도 검색 가능 확인 (BD006: 교육/문화업)
GET http://localhost:8080/api/business/search?businessType=BD006

> {%
    console.log("✅ BD006(교육/문화업) 검색 결과:");
    console.log("   - 검색된 업체 수:", response.body.data.businesses.length);

    if (response.body.data.businesses.length > 0) {
        const found = response.body.data.businesses.find(b => b.businessId === client.global.get("businessId"));
        if (found) {
            console.log("   ✅ 내 업체가 검색됨 (복합 업종 중 하나로 검색 가능)");
        }
    }
%}

### 10. 업종 다시 축소 - 단일 업종으로 변경 (BD001: 숙박업)
PUT http://localhost:8080/api/business/{{businessId}}
Content-Type: application/json
Authorization: {{authHeader}}

{
  "businessName": "게스트하우스",
  "businessTypes": ["BD001"],
  "address": "서울시 강남구 숙박로 789",
  "contactPhone": "02-3333-4444",
  "description": "숙박업으로 업종 전환",
  "logoUrl": null
}

> {%
    console.log("업종 축소 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("✅ 업종 축소 성공:");
        console.log("   - 이전:", ["BD000", "BD003", "BD006"]);
        console.log("   - 현재:", response.body.data.businessTypes);
    }
%}