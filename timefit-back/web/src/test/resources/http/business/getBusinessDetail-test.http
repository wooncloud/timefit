### getBusinessDetail API 테스트 - JWT 기반

### 1. 회원가입 (JWT 토큰 획득)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "detail-test@timefit.com",
  "password": "SecureP@ss123!",
  "name": "홍길동",
  "phoneNumber": "010-1234-5678"
}

> {%
    client.test("회원가입 성공", function() {
        client.assert(response.status === 201, "응답 코드가 201이어야 함");
        client.assert(response.headers.valueOf("Authorization"), "Authorization 헤더가 있어야 함");
        client.assert(response.body.data.accessToken, "accessToken이 응답에 있어야 함");
    });

    const authHeader = response.headers.valueOf("Authorization");
    const accessToken = response.body.data.accessToken;
    client.global.set("detailTestAuthHeader", authHeader);
    client.global.set("detailTestAccessToken", accessToken);
    client.global.set("userId", response.body.data.userId);

    console.log("회원가입 성공 - Authorization:", authHeader?.substring(0, 30) + "...");
    console.log("사용자 정보:", response.body.data.name, response.body.data.email);
%}

### 2. 업체 생성 (businessId 획득)
POST http://localhost:8080/api/business
Content-Type: application/json
Authorization: {{detailTestAuthHeader}}

{
  "businessName": "테스트 미용실",
  "businessType": "미용실",
  "businessNumber": "123-45-67890",
  "address": "서울시 강남구 테헤란로 123",
  "contactPhone": "02-1234-5678",
  "description": "깔끔한 미용실입니다"
}

> {%
    client.test("업체 생성 성공", function() {
        client.assert(response.status === 201, "응답 코드가 201이어야 함");
        client.assert(response.body.data.businessId, "businessId가 응답에 있어야 함");
    });

    if (response.body.data) {
        const businessId = response.body.data.businessId;
        console.log("생성된 업체 ID:", businessId);
        console.log("업체명:", response.body.data.businessName);
        console.log("내 권한:", response.body.data.myRole);
        client.global.set("businessId", businessId);
    }
%}

### 3. 업체 상세 정보 조회 - 기본 성공 케이스
GET http://localhost:8080/api/business/{{businessId}}
Authorization: {{detailTestAuthHeader}}

> {%
    client.test("업체 상세 조회 성공", function() {
        client.assert(response.status === 200, "응답 코드가 200이어야 함");
        client.assert(response.body.data, "응답 데이터가 있어야 함");
        client.assert(response.body.data.businessId, "businessId가 있어야 함");
        client.assert(response.body.data.businessName === "테스트 미용실", "업체명이 일치해야 함");
    });

    console.log("=== 업체 상세 조회 성공 ===");
    console.log("업체 상세 조회 응답:", JSON.stringify(response.body, null, 2));
    console.log("응답 상태:", response.status);

    if (response.body.data) {
        console.log("업체명:", response.body.data.businessName);
        console.log("업체 타입:", response.body.data.businessType);
    }
%}

### 4. 실패 케이스 - 토큰 없이 조회
GET http://localhost:8080/api/business/{{businessId}}

> {%
    client.test("토큰 없는 요청 실패", function() {
        client.assert(response.status === 401, "응답 코드가 401이어야 함");
    });

    console.log("=== 토큰 없는 요청 테스트 ===");
    console.log("토큰 없는 요청 응답 상태:", response.status);
    console.log("토큰 없는 요청 응답:", JSON.stringify(response.body, null, 2));
%}

### 5. 실패 케이스 - 존재하지 않는 업체 ID
GET http://localhost:8080/api/business/00000000-0000-0000-0000-000000000000
Authorization: {{detailTestAuthHeader}}

> {%
    // console.log(response.body.errorResponse.code);
    client.test("존재하지 않는 업체 요청 실패", function() {
        client.assert(response.status === 404, "응답 코드가 404여야 함");
        client.assert(response.body.errorResponse.code === "BUSINESS_NOT_FOUND", "에러 코드가 BUSINESS_NOT_FOUND여야 함");
    });

    console.log("=== 존재하지 않는 업체 요청 테스트 ===");
    console.log("존재하지 않는 업체 응답 상태:", response.status);
    console.log("존재하지 않는 업체 응답:", JSON.stringify(response.body, null, 2));
%}

### 6. 실패 케이스 - 잘못된 UUID 형식
GET http://localhost:8080/api/business/invalid-uuid-format
Authorization: {{detailTestAuthHeader}}

> {%
    client.test("잘못된 UUID 형식 요청 실패", function() {
        client.assert(response.status === 500, "응답 코드가 500이어야 함");
    });

    console.log("=== 잘못된 UUID 형식 테스트 ===");
    console.log("잘못된 UUID 응답 상태:", response.status);
    console.log("잘못된 UUID 응답:", JSON.stringify(response.body, null, 2));
%}

### 7. 실패 케이스 - 잘못된 토큰
GET http://localhost:8080/api/business/{{businessId}}
Authorization: Bearer invalid-token-12345

> {%
    client.test("잘못된 토큰 요청 실패", function() {
        client.assert(response.status === 401, "응답 코드가 401이어야 함");
    });

    console.log("=== 잘못된 토큰 테스트 ===");
    console.log("잘못된 토큰 응답 상태:", response.status);
    console.log("잘못된 토큰 응답:", JSON.stringify(response.body, null, 2));
%}

### 8. 다른 사용자 회원가입 (권한 없는 접근 테스트용)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "other-user@timefit.com",
  "password": "SecureP@ss123!",
  "name": "다른사용자",
  "phoneNumber": "010-9876-5432"
}

> {%
    const otherAuthHeader = response.headers.valueOf("Authorization");
    client.global.set("otherUserAuthHeader", otherAuthHeader);
    console.log("다른 사용자 회원가입 성공");
%}

### 9. 실패 케이스 - 권한 없는 업체 접근
GET http://localhost:8080/api/business/{{businessId}}
Authorization: {{otherUserAuthHeader}}

> {%
    client.test("권한 없는 업체 접근 실패", function() {
        client.assert(response.status === 403, "응답 코드가 403이어야 함");
        client.assert(response.body.error?.code === "USER_NOT_BUSINESS_MEMBER", "에러 코드가 USER_NOT_BUSINESS_MEMBER여야 함");
    });

    console.log("=== 권한 없는 업체 접근 테스트 ===");
    console.log("권한 없는 업체 접근 응답 상태:", response.status);
    console.log("권한 없는 업체 접근 응답:", JSON.stringify(response.body, null, 2));
%}

### 10. 내 업체 목록 조회 (검증용)
GET http://localhost:8080/api/business
Authorization: {{detailTestAuthHeader}}

> {%
    client.test("내 업체 목록 조회 성공", function() {
        client.assert(response.status === 200, "응답 코드가 200이어야 함");
        client.assert(response.body.data, "응답 데이터가 있어야 함");
        client.assert(Array.isArray(response.body.data), "응답 데이터가 배열이어야 함");
    });

    console.log("=== 내 업체 목록 조회 ===");
    console.log("내 업체 목록 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("내가 속한 업체 수:", response.body.data.length);
        response.body.data.forEach((business, index) => {
            console.log(`${index + 1}. ${business.businessName} - ${business.myRole} (${business.businessType})`);
        });
    }
%}

### 11. JWT 토큰 상태 확인 (디버깅용)
GET http://localhost:8080/api/auth/status-test
Authorization: {{detailTestAuthHeader}}

> {%
    console.log("=== JWT 토큰 상태 확인 ===");
    console.log("토큰 상태:", response.status);
    console.log("토큰 응답:", JSON.stringify(response.body, null, 2));
%}