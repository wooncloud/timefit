### 업체 구성원 목록 조회 API 테스트

### 1. 업체 회원가입 (OWNER 사용자 생성)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "members-owner@timefit.com",
  "password": "SecureP@ss123!",
  "name": "김대표",
  "phoneNumber": "010-1111-2222",
  "businessName": "구성원 테스트 헬스장",
  "businessType": "헬스장",
  "businessNumber": "888-88-88888",
  "address": "서울시 강남구 구성원로 888",
  "contactPhone": "02-8888-8888",
  "description": "구성원 관리 테스트용 헬스장입니다"
}

### 2. OWNER 로그인 (토큰 획득)
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "members-owner@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const token = response.headers.valueOf("x-client-token");
    console.log("OWNER 토큰:", token);
    client.global.set("ownerToken", token);

    // 응답에서 businessId 추출
    if (response.body.data && response.body.data.businesses && response.body.data.businesses.length > 0) {
        const businessId = response.body.data.businesses[0].businessId;
        console.log("업체 ID:", businessId);
        client.global.set("businessId", businessId);
    }
%}

### 3. 구성원 목록 조회 - 성공 케이스 (OWNER 권한)
GET http://localhost:8080/api/business/{{businessId}}/members
x-client-token: {{ownerToken}}

> {%
    console.log("OWNER 구성원 조회 응답 상태:", response.status);
    console.log("OWNER 구성원 조회 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data && Array.isArray(response.body.data)) {
        console.log("구성원 수:", response.body.data.length);

        response.body.data.forEach((member, index) => {
            console.log(`구성원 ${index + 1}:`, {
                name: member.name,
                email: member.email,
                role: member.role,
                isActive: member.isActive,
                joinedAt: member.joinedAt
            });
        });

        // OWNER 본인이 목록에 있는지 확인
        const ownerMember = response.body.data.find(m => m.role === "OWNER");
        if (ownerMember) {
            console.log("✅ OWNER가 구성원 목록에 포함됨");
        }
    }
%}

### 4. MANAGER 사용자 회원가입 (추가 구성원 테스트용)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "members-manager@timefit.com",
  "password": "SecureP@ss123!",
  "name": "박매니저",
  "phoneNumber": "010-2222-3333",
  "businessName": "매니저 테스트 업체",
  "businessType": "테스트",
  "businessNumber": "999-99-99999",
  "address": "서울시 강남구 매니저로 999",
  "contactPhone": "02-9999-9999",
  "description": "매니저 테스트용 업체"
}

### 5. MANAGER 로그인
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "members-manager@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const managerToken = response.headers.valueOf("x-client-token");
    console.log("MANAGER 토큰:", managerToken);
    client.global.set("managerToken", managerToken);
%}

### 6. 실패 케이스 - MANAGER가 다른 업체 구성원 조회 (권한 없음)
GET http://localhost:8080/api/business/{{businessId}}/members
x-client-token: {{managerToken}}

> {%
    console.log("다른 업체 MANAGER 조회 응답 상태:", response.status);
    console.log("다른 업체 MANAGER 조회 응답:", JSON.stringify(response.body, null, 2));
%}

### 7. MEMBER 사용자 회원가입 (권한 테스트용)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "members-member@timefit.com",
  "password": "SecureP@ss123!",
  "name": "이멤버",
  "phoneNumber": "010-3333-4444",
  "businessName": "멤버 테스트 업체",
  "businessType": "테스트",
  "businessNumber": "111-22-33333",
  "address": "서울시 강남구 멤버로 111",
  "contactPhone": "02-1111-2222",
  "description": "멤버 테스트용 업체"
}

### 8. MEMBER 로그인
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "members-member@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const memberToken = response.headers.valueOf("x-client-token");
    console.log("MEMBER 토큰:", memberToken);
    client.global.set("memberToken", memberToken);
%}

### 9. 실패 케이스 - MEMBER가 구성원 조회 (권한 부족)
GET http://localhost:8080/api/business/{{businessId}}/members
x-client-token: {{memberToken}}

> {%
    console.log("MEMBER 구성원 조회 응답 상태:", response.status);
    console.log("MEMBER 구성원 조회 응답:", JSON.stringify(response.body, null, 2));
%}

### 10. 실패 케이스 - 토큰 없이 조회
GET http://localhost:8080/api/business/{{businessId}}/members

> {%
    console.log("토큰 없는 구성원 조회 응답 상태:", response.status);
    console.log("토큰 없는 구성원 조회 응답:", JSON.stringify(response.body, null, 2));
%}

### 11. 실패 케이스 - 존재하지 않는 업체
GET http://localhost:8080/api/business/00000000-0000-0000-0000-000000000000/members
x-client-token: {{ownerToken}}

> {%
    console.log("존재하지 않는 업체 구성원 조회 응답 상태:", response.status);
    console.log("존재하지 않는 업체 구성원 조회 응답:", JSON.stringify(response.body, null, 2));
%}

### 12. 실패 케이스 - 잘못된 UUID 형식
GET http://localhost:8080/api/business/invalid-uuid-format/members
x-client-token: {{ownerToken}}

> {%
    console.log("잘못된 UUID 구성원 조회 응답 상태:", response.status);
    console.log("잘못된 UUID 구성원 조회 응답:", JSON.stringify(response.body, null, 2));
%}

### 13. 실패 케이스 - 권한 없는 업체 접근 (다른 업체 ID)
GET http://localhost:8080/api/business/11111111-1111-1111-1111-111111111111/members
x-client-token: {{ownerToken}}

> {%
    console.log("권한 없는 업체 구성원 조회 응답 상태:", response.status);
    console.log("권한 없는 업체 구성원 조회 응답:", JSON.stringify(response.body, null, 2));
%}

### 14. 업체 비활성화 후 구성원 조회 테스트
POST http://localhost:8080/api/business/{{businessId}}/toggle-status
x-client-token: {{ownerToken}}

> {%
    console.log("업체 비활성화 응답:", JSON.stringify(response.body, null, 2));
%}

### 15. 실패 케이스 - 비활성화된 업체의 구성원 조회
GET http://localhost:8080/api/business/{{businessId}}/members
x-client-token: {{ownerToken}}

> {%
    console.log("비활성화된 업체 구성원 조회 응답 상태:", response.status);
    console.log("비활성화된 업체 구성원 조회 응답:", JSON.stringify(response.body, null, 2));
%}

### 16. 업체 재활성화
POST http://localhost:8080/api/business/{{businessId}}/toggle-status
x-client-token: {{ownerToken}}

> {%
    console.log("업체 재활성화 응답:", JSON.stringify(response.body, null, 2));
%}

### 17. 재활성화 후 구성원 조회 - 정상 복구 확인
GET http://localhost:8080/api/business/{{businessId}}/members
x-client-token: {{ownerToken}}

> {%
    console.log("재활성화 후 구성원 조회 응답 상태:", response.status);
    console.log("재활성화 후 구성원 조회 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data && Array.isArray(response.body.data)) {
        console.log("재활성화 후 구성원 수:", response.body.data.length);
        console.log("✅ 업체 재활성화 후 구성원 조회 정상 복구");

        // 구성원 정보 검증
        response.body.data.forEach((member, index) => {
            console.log(`최종 구성원 ${index + 1}:`, {
                userId: member.userId,
                name: member.name,
                email: member.email,
                role: member.role,
                isActive: member.isActive,
                joinedAt: member.joinedAt,
                lastLoginAt: member.lastLoginAt
            });

            // 필수 필드 검증
            if (!member.userId || !member.name || !member.role) {
                console.log("⚠️ 구성원 정보에 필수 필드 누락");
            }
        });
    }
%}