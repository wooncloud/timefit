### ================================================================
### Timefit Operating Hours Toggle í…ŒìŠ¤íŠ¸ (ìš”ì¼ ì „ì²´)
### ğŸ“ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:
###    1. Owner ë¡œê·¸ì¸ (seed-bulk.sql ë°ì´í„° ì‚¬ìš©)
###    2. ì˜ì—…ì‹œê°„ ì „ì²´ ì¡°íšŒ (ì´ˆê¸° ìƒíƒœ í™•ì¸)
###    3. ì¼ìš”ì¼ ì „ì²´ íœ´ë¬´ í† ê¸€ â†’ ëª¨ë“  ì‹œê°„ëŒ€(seq=0,1) isClosed: false â†’ true
###    4. ì˜ì—…ì‹œê°„ ì¬ì¡°íšŒ (ë³€ê²½ í™•ì¸)
###    9. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìš”ì¼ í…ŒìŠ¤íŠ¸ (ì—ëŸ¬ 404)
###    10. ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ (Customerë¡œ ì‹œë„ â†’ ì—ëŸ¬ 403)
### ================================================================
###
### ğŸ“Œ ì‚¬ì „ ì¤€ë¹„:
###    - seed-bulk.sql ì‹¤í–‰ í•„ìš”
###    - Business ID: 30000000-0000-0000-0000-000000000001 (Timefit Hair Salon)
###    - Owner: owner1@timefit.com / password: password123
###    - Customer: customer1@timefit.com / password: password123
###
### ğŸ“Š Operating Hours ì´ˆê¸° ë°ì´í„°:
###    ì›”~ê¸ˆ: sequence=0 (09:00-12:00), sequence=1 (13:00-18:00)
###    í† ~ì¼: sequence=0 (09:00-14:00)
###
### ğŸ”¢ dayOfWeek ê°’ (Enum ORDINAL):
###    0=MONDAY, 1=TUESDAY, 2=WEDNESDAY, 3=THURSDAY, 4=FRIDAY, 5=SATURDAY, 6=SUNDAY
###
### âš ï¸ ì£¼ìš” ë³€ê²½: sequence íŒŒë¼ë¯¸í„° ì œê±°, ìš”ì¼ ì „ì²´ ì‹œê°„ëŒ€ ì¼ê´„ í† ê¸€
### ================================================================

@baseUrl = http://localhost:8080
@businessId = 30000000-0000-0000-0000-000000000001

### ================================================================
### 1. Owner ë¡œê·¸ì¸ (seed-bulk.sql ë°ì´í„°)
### ================================================================

# @name Ownerë¡œê·¸ì¸
POST {{baseUrl}}/api/auth/signin
Content-Type: application/json

{
  "email": "owner1@timefit.com",
  "password": "password123"
}

> {%
    client.test("ë¡œê·¸ì¸ ì„±ê³µ", function() {
        client.assert(response.status === 200, "ì‘ë‹µ ì½”ë“œê°€ 200ì´ì–´ì•¼ í•¨");
    });

    if (response.body.data && response.body.data.accessToken) {
        client.global.set("ownerToken", response.body.data.accessToken);
        console.log("âœ… [1/10] Owner ë¡œê·¸ì¸ ì„±ê³µ");
        console.log("   - Email: owner1@timefit.com");
        console.log("   - User ID:", response.body.data.userId);
    } else {
        console.error("âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:", response.status, response.body);
    }
%}

###

### ================================================================
### 2. ì˜ì—…ì‹œê°„ ì „ì²´ ì¡°íšŒ (ì´ˆê¸° ìƒíƒœ í™•ì¸)
### ================================================================

# @name ì˜ì—…ì‹œê°„ì¡°íšŒ_ì´ˆê¸°
GET {{baseUrl}}/api/business/{{businessId}}/operating-hours
Authorization: Bearer {{ownerToken}}

> {%
    client.test("ì˜ì—…ì‹œê°„ ì¡°íšŒ ì„±ê³µ", function() {
        client.assert(response.status === 200, "ì‘ë‹µ ì½”ë“œê°€ 200ì´ì–´ì•¼ í•¨");
    });

    if (response.status === 200) {
        console.log("âœ… [2/10] ì˜ì—…ì‹œê°„ ì¡°íšŒ ì„±ê³µ");
        console.log("   - Business:", response.body.data.businessName);

        // ì›”ìš”ì¼(dayOfWeek=0) í™•ì¸
        const monday = response.body.data.schedules.find(s => s.dayOfWeek === 0);
        if (monday) {
            console.log("   - ì›”ìš”ì¼ ì˜ì—…ì‹œê°„:", monday.openTime, "~", monday.closeTime);
            console.log("   - ì›”ìš”ì¼ ì˜ˆì•½ ì‹œê°„ëŒ€ ê°œìˆ˜:", monday.bookingTimeRanges.length);
            monday.bookingTimeRanges.forEach(range => {
                console.log("     * sequence=" + range.sequence + ":", range.startTime, "~", range.endTime, "/ isClosed:", range.isClosed);
            });
        }
    } else {
        console.error("âŒ ì¡°íšŒ ì‹¤íŒ¨:", response.status, response.body);
    }
%}

###

### ================================================================
### 3. ì›”ìš”ì¼ ì „ì²´ íœ´ë¬´ í† ê¸€ â†’ ëª¨ë“  ì‹œê°„ëŒ€ isClosed: false â†’ true
### ================================================================

# @name ì›”ìš”ì¼ì „ì²´_íœ´ë¬´í† ê¸€_1ì°¨
PATCH {{baseUrl}}/api/business/{{businessId}}/operating-hours/0/toggle
Authorization: Bearer {{ownerToken}}

> {%
    client.test("í† ê¸€ ì„±ê³µ", function() {
        client.assert(response.status === 200, "ì‘ë‹µ ì½”ë“œê°€ 200ì´ì–´ì•¼ í•¨");
    });

    if (response.status === 200) {
        console.log("âœ… [3/10] ì›”ìš”ì¼ ì „ì²´ íœ´ë¬´ í† ê¸€ ì„±ê³µ");

        const monday = response.body.data.schedules.find(s => s.dayOfWeek === 0);

        console.log("   - í† ê¸€ ê²°ê³¼:");
        monday.bookingTimeRanges.forEach(range => {
            console.log("     * sequence=" + range.sequence + ":", range.startTime + "~" + range.endTime, "â†’ isClosed =", range.isClosed);
            client.assert(range.isClosed === true, "ëª¨ë“  ì‹œê°„ëŒ€ê°€ íœ´ë¬´ì—¬ì•¼ í•¨");
        });
    } else {
        console.error("âŒ í† ê¸€ ì‹¤íŒ¨:", response.status, response.body);
    }
%}

###

### ================================================================
### 4. ì˜ì—…ì‹œê°„ ì¬ì¡°íšŒ (ë³€ê²½ í™•ì¸)
### ================================================================

# @name ì˜ì—…ì‹œê°„ì¡°íšŒ_1ì°¨í† ê¸€í›„
GET {{baseUrl}}/api/business/{{businessId}}/operating-hours
Authorization: Bearer {{ownerToken}}

> {%
    if (response.status === 200) {
        console.log("âœ… [4/10] í† ê¸€ í›„ ì˜ì—…ì‹œê°„ ì¬ì¡°íšŒ");

        const monday = response.body.data.schedules.find(s => s.dayOfWeek === 0);

        // ì›”ìš”ì¼ ì „ì²´ íœ´ë¬´ ìƒíƒœ í™•ì¸ (BusinessHours ë ˆë²¨)
        console.log("   - ì›”ìš”ì¼ isClosed:", monday.isClosed);
        client.assert(monday.isClosed === true, "ì›”ìš”ì¼ ì „ì²´ê°€ íœ´ë¬´ì—¬ì•¼ í•¨");

        // ì›”ìš”ì¼ ì‹œê°„ëŒ€ë³„ íœ´ë¬´ ìƒíƒœ í™•ì¸ (OperatingHours ë ˆë²¨)
        console.log("   - ì›”ìš”ì¼ ì „ì²´ ì‹œê°„ëŒ€:");
        monday.bookingTimeRanges.forEach(range => {
            console.log("     * sequence=" + range.sequence + ": isClosed =", range.isClosed);
            client.assert(range.isClosed === true, "ëª¨ë“  ì‹œê°„ëŒ€ê°€ íœ´ë¬´ì—¬ì•¼ í•¨");
        });

        // í™”ìš”ì¼ì€ ê·¸ëŒ€ë¡œì¸ì§€ í™•ì¸
        const tuesday = response.body.data.schedules.find(s => s.dayOfWeek === 1);
        console.log("   - í™”ìš”ì¼ isClosed:", tuesday.isClosed);
        client.assert(tuesday.isClosed === false, "í™”ìš”ì¼ ì „ì²´ëŠ” ì˜ì—…ì´ì–´ì•¼ í•¨");

        tuesday.bookingTimeRanges.forEach(range => {
            client.assert(range.isClosed === false, "í™”ìš”ì¼ ì‹œê°„ëŒ€ëŠ” ì˜ì—…ì´ì–´ì•¼ í•¨");
        });
        console.log("   - í™”ìš”ì¼ì€ ì˜ì—… ìƒíƒœ ìœ ì§€ âœ“");
    } else {
        console.error("âŒ ì¡°íšŒ ì‹¤íŒ¨:", response.status, response.body);
    }
%}

###

### ================================================================
### 9. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìš”ì¼ í…ŒìŠ¤íŠ¸ (ì—ëŸ¬ 404 ê¸°ëŒ€)
### ğŸ“Œ dayOfWeekì€ 0~6ë§Œ ìœ íš¨ â†’ 7ì€ ì—†ìŒ
### ================================================================

# @name ì¡´ì¬í•˜ì§€ì•ŠëŠ”ìš”ì¼_ì—ëŸ¬í…ŒìŠ¤íŠ¸
PATCH {{baseUrl}}/api/business/{{businessId}}/operating-hours/7/toggle
Authorization: Bearer {{ownerToken}}

> {%
    client.test("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìš”ì¼ ì—ëŸ¬", function() {
        client.assert(response.status === 400 || response.status === 404,
            "ì‘ë‹µ ì½”ë“œê°€ 400 ë˜ëŠ” 404ì—¬ì•¼ í•¨");
    });

    if (response.status === 400 || response.status === 404) {
        console.log("âœ… [9/10] ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìš”ì¼ ì—ëŸ¬ ë°œìƒ (ì •ìƒ)");
        console.log("   - ìƒíƒœ ì½”ë“œ:", response.status);
        console.log("   - ì—ëŸ¬ ë©”ì‹œì§€:", response.body.error?.message || response.body.message);
    } else {
        console.error("âŒ ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ:", response.status, response.body);
    }
%}

###

### ================================================================
### 10. ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ (Customerë¡œ ì‹œë„ â†’ ì—ëŸ¬ 403)
### ================================================================

# @name Customerë¡œê·¸ì¸
POST {{baseUrl}}/api/auth/signin
Content-Type: application/json

{
  "email": "customer1@timefit.com",
  "password": "password123"
}

> {%
    if (response.body.data && response.body.data.accessToken) {
        client.global.set("customerToken", response.body.data.accessToken);
        console.log("ğŸ“Œ Customer ë¡œê·¸ì¸ ì„±ê³µ (ê¶Œí•œ í…ŒìŠ¤íŠ¸ìš©)");
    }
%}

###

# @name ê¶Œí•œì—†ëŠ”ì‚¬ìš©ì_ì—ëŸ¬í…ŒìŠ¤íŠ¸
PATCH {{baseUrl}}/api/business/{{businessId}}/operating-hours/0/toggle
Authorization: Bearer {{customerToken}}

> {%
    client.test("ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ì ì—ëŸ¬", function() {
        client.assert(response.status === 403, "ì‘ë‹µ ì½”ë“œê°€ 403ì´ì–´ì•¼ í•¨");
    });

    if (response.status === 403) {
        console.log("âœ… [10/10] ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ì ì—ëŸ¬ ë°œìƒ (ì •ìƒ)");
        console.log("   - ì—ëŸ¬ ì½”ë“œ:", response.body.error.errorCode);
        console.log("   - ì—ëŸ¬ ë©”ì‹œì§€:", response.body.error.message);

        client.assert(response.body.error.errorCode === "INSUFFICIENT_PERMISSION" ||
            response.body.error.errorCode === "USER_NOT_BUSINESS_MEMBER",
            "ê¶Œí•œ ê´€ë ¨ ì—ëŸ¬ ì½”ë“œì—¬ì•¼ í•¨");
    } else {
        console.error("âŒ ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ:", response.status, response.body);
    }
%}

###
