### 예약 신청 API 테스트

### 1. 고객 사용자 회원가입 (예약 신청자)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "reservation-customer@timefit.com",
  "password": "SecureP@ss123!",
  "name": "예약고객",
  "phoneNumber": "010-1111-2222",
  "businessName": "고객 개인업체",
  "businessType": "개인",
  "businessNumber": "111-11-11111",
  "address": "서울시 강남구 고객로 111",
  "contactPhone": "02-1111-1111",
  "description": "고객용 개인 업체"
}

### 2. 고객 로그인 (토큰 획득)
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "reservation-customer@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const token = response.headers.valueOf("x-client-token");
    console.log("고객 토큰:", token);
    client.global.set("customerToken", token);
%}

### 3. 업체 사용자 회원가입 (예약 받을 업체)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "reservation-business@timefit.com",
  "password": "SecureP@ss123!",
  "name": "업체사장",
  "phoneNumber": "010-2222-3333",
  "businessName": "예약 테스트 헬스장",
  "businessType": "헬스장",
  "businessNumber": "222-22-22222",
  "address": "서울시 강남구 헬스로 222",
  "contactPhone": "02-2222-2222",
  "description": "예약 가능한 헬스장입니다"
}

### 4. 업체 사용자 로그인
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "reservation-business@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const businessToken = response.headers.valueOf("x-client-token");
    console.log("업체 토큰:", businessToken);
    client.global.set("businessToken", businessToken);

    // 응답에서 businessId 추출
    if (response.body.data && response.body.data.businesses && response.body.data.businesses.length > 0) {
        const businessId = response.body.data.businesses[0].businessId;
        console.log("업체 ID:", businessId);
        client.global.set("businessId", businessId);
    }
%}

### 5. 예약 신청 - 성공 케이스
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "11111111-1111-1111-1111-111111111111",
  "reservationDate": "2025-01-20",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "처음 방문입니다. 헬스 초보자예요."
}

> {%
    console.log("예약 신청 응답 상태:", response.status);
    console.log("예약 신청 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("예약 ID:", response.body.data.reservationId);
        console.log("예약 번호:", response.body.data.reservationNumber);
        console.log("예약 상태:", response.body.data.status);
        console.log("예약 일시:", response.body.data.reservationDate, response.body.data.reservationTime);
        console.log("업체명:", response.body.data.businessName);
        console.log("총 가격:", response.body.data.totalPrice);

        client.global.set("reservationId", response.body.data.reservationId);
        client.global.set("reservationNumber", response.body.data.reservationNumber);
    }
%}

### 6. 다른 시간대 예약 신청 - 성공 케이스
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "22222222-2222-2222-2222-222222222222",
  "reservationDate": "2025-01-21",
  "reservationTime": "10:00",
  "durationMinutes": 90,
  "totalPrice": 70000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "아침 운동 예약입니다."
}

> {%
    console.log("두 번째 예약 신청 응답 상태:", response.status);
    console.log("두 번째 예약 신청 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("두 번째 예약 번호:", response.body.data.reservationNumber);
        client.global.set("secondReservationId", response.body.data.reservationId);
    }
%}

### 7. 실패 케이스 - 토큰 없이 예약 신청
POST http://localhost:8080/api/reservations
Content-Type: application/json

{
  "businessId": "{{businessId}}",
  "availableSlotId": "11111111-1111-1111-1111-111111111111",
  "reservationDate": "2025-01-22",
  "reservationTime": "16:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "토큰없는고객",
  "customerPhone": "010-9999-9999",
  "notes": "토큰 없이 예약 시도"
}

> {%
    console.log("토큰 없는 예약 응답 상태:", response.status);
    console.log("토큰 없는 예약 응답:", JSON.stringify(response.body, null, 2));
%}

### 8. 실패 케이스 - 과거 날짜 예약 시도
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "11111111-1111-1111-1111-111111111111",
  "reservationDate": "2024-12-01",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "과거 날짜 예약 시도"
}

> {%
    console.log("과거 날짜 예약 응답 상태:", response.status);
    console.log("과거 날짜 예약 응답:", JSON.stringify(response.body, null, 2));
%}

### 9. 실패 케이스 - 존재하지 않는 업체에 예약
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "00000000-0000-0000-0000-000000000000",
  "availableSlotId": "11111111-1111-1111-1111-111111111111",
  "reservationDate": "2025-01-23",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "존재하지 않는 업체 예약 시도"
}

> {%
    console.log("존재하지 않는 업체 예약 응답 상태:", response.status);
    console.log("존재하지 않는 업체 예약 응답:", JSON.stringify(response.body, null, 2));
%}

### 10. 실패 케이스 - 존재하지 않는 슬롯 ID
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "00000000-0000-0000-0000-000000000000",
  "reservationDate": "2025-01-24",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "존재하지 않는 슬롯 예약 시도"
}

> {%
    console.log("존재하지 않는 슬롯 예약 응답 상태:", response.status);
    console.log("존재하지 않는 슬롯 예약 응답:", JSON.stringify(response.body, null, 2));
%}

### 11. 실패 케이스 - 필수 필드 누락 (businessId 없음)
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "availableSlotId": "11111111-1111-1111-1111-111111111111",
  "reservationDate": "2025-01-25",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "필수 필드 누락 테스트"
}

> {%
    console.log("필수 필드 누락 예약 응답 상태:", response.status);
    console.log("필수 필드 누락 예약 응답:", JSON.stringify(response.body, null, 2));
%}

### 12. 실패 케이스 - 잘못된 날짜 형식
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "11111111-1111-1111-1111-111111111111",
  "reservationDate": "invalid-date",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "잘못된 날짜 형식 테스트"
}

> {%
    console.log("잘못된 날짜 형식 예약 응답 상태:", response.status);
    console.log("잘못된 날짜 형식 예약 응답:", JSON.stringify(response.body, null, 2));
%}

### 13. 실패 케이스 - 잘못된 시간 형식
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "11111111-1111-1111-1111-111111111111",
  "reservationDate": "2025-01-26",
  "reservationTime": "25:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "잘못된 시간 형식 테스트"
}

> {%
    console.log("잘못된 시간 형식 예약 응답 상태:", response.status);
    console.log("잘못된 시간 형식 예약 응답:", JSON.stringify(response.body, null, 2));
%}

### 14. 실패 케이스 - 음수 가격
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "11111111-1111-1111-1111-111111111111",
  "reservationDate": "2025-01-27",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": -10000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "음수 가격 테스트"
}

> {%
    console.log("음수 가격 예약 응답 상태:", response.status);
    console.log("음수 가격 예약 응답:", JSON.stringify(response.body, null, 2));
%}

### 15. 실패 케이스 - 0분 예약 시간
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "11111111-1111-1111-1111-111111111111",
  "reservationDate": "2025-01-28",
  "reservationTime": "14:00",
  "durationMinutes": 0,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "0분 예약 시간 테스트"
}

> {%
    console.log("0분 예약 시간 응답 상태:", response.status);
    console.log("0분 예약 시간 응답:", JSON.stringify(response.body, null, 2));
%}

### 16. 성공 케이스 - 최소 정보로 예약 (선택 필드 제외)
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "33333333-3333-3333-3333-333333333333",
  "reservationDate": "2025-01-29",
  "reservationTime": "18:00",
  "durationMinutes": 30,
  "totalPrice": 30000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222"
}

> {%
    console.log("최소 정보 예약 응답 상태:", response.status);
    console.log("최소 정보 예약 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("최소 정보 예약 번호:", response.body.data.reservationNumber);
        console.log("✅ 최소 필수 정보로 예약 성공");
    }
%}

### 17. 예약 번호 생성 패턴 확인
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "44444444-4444-4444-4444-444444444444",
  "reservationDate": "2025-01-30",
  "reservationTime": "20:00",
  "durationMinutes": 45,
  "totalPrice": 40000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "예약 번호 패턴 확인용"
}

> {%
    console.log("예약 번호 패턴 확인 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        const reservationNumber = response.body.data.reservationNumber;
        console.log("생성된 예약 번호:", reservationNumber);

        // 예약 번호 패턴 검증 (RES-YYYYMMDD-XXX)
        const pattern = /^RES-\d{8}-\d{3}$/;
        if (pattern.test(reservationNumber)) {
            console.log("✅ 예약 번호 패턴 올바름:", reservationNumber);
        } else {
            console.log("⚠️ 예약 번호 패턴이 올바르지 않음:", reservationNumber);
        }
    }
%}