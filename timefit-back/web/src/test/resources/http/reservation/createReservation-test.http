### 예약 신청 API 테스트

### 1. 고객 사용자 회원가입 (예약 신청자)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "reservation-customer@timefit.com",
  "password": "SecureP@ss123!",
  "name": "예약고객",
  "phoneNumber": "010-1111-2222",
  "businessName": "고객 개인업체",
  "businessType": "개인",
  "businessNumber": "111-11-11111",
  "address": "서울시 강남구 고객로 111",
  "contactPhone": "02-1111-1111",
  "description": "고객용 개인 업체"
}

### 2. 고객 로그인 (토큰 획득)
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "reservation-customer@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const token = response.headers.valueOf("x-client-token");
    console.log("고객 토큰:", token);
    client.global.set("customerToken", token);
%}

### 3. 업체 사용자 회원가입 (예약 받을 업체)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "reservation-business@timefit.com",
  "password": "SecureP@ss123!",
  "name": "업체사장",
  "phoneNumber": "010-2222-3333",
  "businessName": "예약 테스트 헬스장",
  "businessType": "헬스장",
  "businessNumber": "222-22-22222",
  "address": "서울시 강남구 헬스로 222",
  "contactPhone": "02-2222-2222",
  "description": "예약 가능한 헬스장입니다"
}

### 4. 업체 사용자 로그인
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "reservation-business@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const businessToken = response.headers.valueOf("x-client-token");
    console.log("업체 토큰:", businessToken);
    client.global.set("businessToken", businessToken);

    // 응답에서 businessId 추출
    if (response.body.data && response.body.data.businesses && response.body.data.businesses.length > 0) {
        const businessId = response.body.data.businesses[0].businessId;
        console.log("업체 ID:", businessId);
        client.global.set("businessId", businessId);
    }
%}

### 5. 업체 영업시간 설정 (Schedule API)
PUT http://localhost:8080/api/schedule/operating-hours?businessId={{businessId}}
Content-Type: application/json
x-client-token: {{businessToken}}

{
  "businessHours": [
    {
      "dayOfWeek": 1,
      "openTime": "09:00",
      "closeTime": "20:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 2,
      "openTime": "09:00",
      "closeTime": "20:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 3,
      "openTime": "09:00",
      "closeTime": "20:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 4,
      "openTime": "09:00",
      "closeTime": "20:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 5,
      "openTime": "09:00",
      "closeTime": "20:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 6,
      "openTime": "10:00",
      "closeTime": "18:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 0,
      "openTime": null,
      "closeTime": null,
      "isClosed": true
    }
  ]
}

> {%
    console.log("영업시간 설정 응답:", JSON.stringify(response.body, null, 2));
    if (response.body.data) {
        console.log("✅ 영업시간 설정 완료 - " + response.body.data.businessName);
    }
%}

### 6. 첫 번째 예약 슬롯 생성 (8월 20일 14:00-15:00)
POST http://localhost:8080/api/schedule/available-slots?businessId={{businessId}}
Content-Type: application/json
x-client-token: {{businessToken}}

{
  "slotDate": "2025-08-20",
  "startTime": "14:00",
  "endTime": "15:00",
  "capacity": 3
}

> {%
    console.log("첫 번째 슬롯 생성 응답:", JSON.stringify(response.body, null, 2));
    if (response.body.data) {
        console.log("✅ 첫 번째 슬롯 생성 성공: " + response.body.data.slotId);
        client.global.set("firstSlotId", response.body.data.slotId);
    }
%}

### 7. 두 번째 예약 슬롯 생성 (8월 21일 10:00-11:30)
POST http://localhost:8080/api/schedule/available-slots?businessId={{businessId}}
Content-Type: application/json
x-client-token: {{businessToken}}

{
  "slotDate": "2025-08-21",
  "startTime": "10:00",
  "endTime": "11:30",
  "capacity": 2
}

> {%
    console.log("두 번째 슬롯 생성 응답:", JSON.stringify(response.body, null, 2));
    if (response.body.data) {
        console.log("✅ 두 번째 슬롯 생성 성공: " + response.body.data.slotId);
        client.global.set("secondSlotId", response.body.data.slotId);
    }
%}

### 8. 세 번째 예약 슬롯 생성 (8월 29일 18:00-18:30)
POST http://localhost:8080/api/schedule/available-slots?businessId={{businessId}}
Content-Type: application/json
x-client-token: {{businessToken}}

{
  "slotDate": "2025-08-29",
  "startTime": "18:00",
  "endTime": "18:30",
  "capacity": 1
}

> {%
    console.log("세 번째 슬롯 생성 응답:", JSON.stringify(response.body, null, 2));
    if (response.body.data) {
        console.log("✅ 세 번째 슬롯 생성 성공: " + response.body.data.slotId);
        client.global.set("thirdSlotId", response.body.data.slotId);
    }
%}

### 9. 예약 신청 - 성공 케이스 (첫 번째 슬롯)
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "{{firstSlotId}}",
  "reservationDate": "2025-08-20",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "처음 방문입니다. 헬스 초보자예요."
}

> {%
    console.log("예약 신청 응답 상태:", response.status);
    console.log("예약 신청 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("✅ 예약 성공!");
        console.log("예약 ID:", response.body.data.reservationId);
        console.log("예약 번호:", response.body.data.reservationNumber);
        console.log("예약 상태:", response.body.data.status);
        console.log("예약 일시:", response.body.data.reservationDate, response.body.data.reservationTime);
        console.log("총 가격:", response.body.data.totalPrice);

        client.global.set("reservationId", response.body.data.reservationId);
        client.global.set("reservationNumber", response.body.data.reservationNumber);
    } else {
        console.log("❌ 예약 실패");
    }
%}

### 10. 다른 시간대 예약 신청 - 성공 케이스 (두 번째 슬롯)
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "{{secondSlotId}}",
  "reservationDate": "2025-08-21",
  "reservationTime": "10:00",
  "durationMinutes": 90,
  "totalPrice": 70000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "아침 운동 예약입니다."
}

> {%
    console.log("두 번째 예약 신청 응답 상태:", response.status);
    if (response.body.data) {
        console.log("✅ 두 번째 예약 성공!");
        console.log("두 번째 예약 번호:", response.body.data.reservationNumber);
        client.global.set("secondReservationId", response.body.data.reservationId);
    } else {
        console.log("❌ 두 번째 예약 실패");
    }
%}

### 11. 최소 정보로 예약 - 성공 케이스 (세 번째 슬롯)
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "{{thirdSlotId}}",
  "reservationDate": "2025-08-29",
  "reservationTime": "18:00",
  "durationMinutes": 30,
  "totalPrice": 30000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222"
}

> {%
    console.log("최소 정보 예약 응답 상태:", response.status);
    if (response.body.data) {
        console.log("✅ 최소 정보 예약 성공!");
        console.log("최소 정보 예약 번호:", response.body.data.reservationNumber);

        // 예약 번호 패턴 검증 (RES-YYYYMMDD-XXX)
        const reservationNumber = response.body.data.reservationNumber;
        const pattern = /^RES-\d{8}-\d{3}$/;
        if (pattern.test(reservationNumber)) {
            console.log("✅ 예약 번호 패턴 올바름:", reservationNumber);
        } else {
            console.log("⚠️ 예약 번호 패턴이 올바르지 않음:", reservationNumber);
        }
    } else {
        console.log("❌ 최소 정보 예약 실패");
    }
%}

### 12. 실패 케이스 - 과거 날짜 예약 시도
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "{{firstSlotId}}",
  "reservationDate": "2024-12-01",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "과거 날짜 예약 시도"
}

> {%
    console.log("과거 날짜 예약 응답 상태:", response.status);
    if (response.status === 400) {
        console.log("✅ 과거 날짜 예약 차단 성공");
    } else {
        console.log("⚠️ 과거 날짜 예약이 허용됨");
    }
%}

### 13. 실패 케이스 - 존재하지 않는 업체에 예약
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "00000000-0000-0000-0000-000000000000",
  "availableSlotId": "{{firstSlotId}}",
  "reservationDate": "2025-08-23",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "존재하지 않는 업체 예약 시도"
}

> {%
    console.log("존재하지 않는 업체 예약 응답 상태:", response.status);
    if (response.status === 404) {
        console.log("✅ 존재하지 않는 업체 예약 차단 성공");
    } else {
        console.log("⚠️ 존재하지 않는 업체 예약이 허용됨");
    }
%}

### 14. 실패 케이스 - 필수 필드 누락 (businessId 없음)
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "availableSlotId": "{{firstSlotId}}",
  "reservationDate": "2025-08-25",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "필수 필드 누락 테스트"
}

> {%
    console.log("필수 필드 누락 예약 응답 상태:", response.status);
    if (response.status === 400) {
        console.log("✅ 필수 필드 누락 검증 성공");
    } else {
        console.log("⚠️ 필수 필드 누락이 허용됨");
    }
%}

### 15. 실패 케이스 - 음수 가격
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId}}",
  "availableSlotId": "{{firstSlotId}}",
  "reservationDate": "2025-08-27",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": -10000,
  "customerName": "예약고객",
  "customerPhone": "010-1111-2222",
  "notes": "음수 가격 테스트"
}

> {%
    console.log("음수 가격 예약 응답 상태:", response.status);
    if (response.status === 400) {
        console.log("✅ 음수 가격 검증 성공");
    } else {
        console.log("⚠️ 음수 가격이 허용됨");
    }
%}