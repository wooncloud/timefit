### 예약 조회 API 테스트

### 1. 고객 사용자 회원가입 (예약 조회자)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "my-reservations@timefit.com",
  "password": "SecureP@ss123!",
  "name": "예약조회고객",
  "phoneNumber": "010-1111-2222",
  "businessName": "고객 개인업체",
  "businessType": "개인",
  "businessNumber": "111-11-11111",
  "address": "서울시 강남구 고객로 111",
  "contactPhone": "02-1111-1111",
  "description": "고객용 개인 업체"
}

### 2. 고객 로그인 (토큰 획득)
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "my-reservations@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const token = response.headers.valueOf("x-client-token");
    console.log("고객 토큰:", token);
    client.global.set("customerToken", token);
%}

### 3. 업체 1 회원가입 (헬스장)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "gym-business@timefit.com",
  "password": "SecureP@ss123!",
  "name": "헬스장사장",
  "phoneNumber": "010-2222-3333",
  "businessName": "파워짐 강남점",
  "businessType": "헬스장",
  "businessNumber": "222-22-22222",
  "address": "서울시 강남구 헬스로 222",
  "contactPhone": "02-2222-2222",
  "description": "헬스장입니다"
}

### 4. 업체 1 로그인 (businessId 획득)
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "gym-business@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const businessToken1 = response.headers.valueOf("x-client-token");
    console.log("업체 1 토큰:", businessToken1);
    client.global.set("businessToken1", businessToken1);

    if (response.body.data && response.body.data.businesses && response.body.data.businesses.length > 0) {
        const businessId1 = response.body.data.businesses[0].businessId;
        console.log("업체 1 ID:", businessId1);
        client.global.set("businessId1", businessId1);
    }
%}

### 5. 업체 2 회원가입 (카페)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "cafe-business@timefit.com",
  "password": "SecureP@ss123!",
  "name": "카페사장",
  "phoneNumber": "010-3333-4444",
  "businessName": "스타벅스 역삼점",
  "businessType": "카페",
  "businessNumber": "333-33-33333",
  "address": "서울시 강남구 카페로 333",
  "contactPhone": "02-3333-3333",
  "description": "카페입니다"
}

### 6. 업체 2 로그인 (businessId 획득)
POST http://localhost:8080/api/auth/signin
Content-Type: application/json

{
  "email": "cafe-business@timefit.com",
  "password": "SecureP@ss123!"
}
> {%
    const businessToken2 = response.headers.valueOf("x-client-token");
    console.log("업체 2 토큰:", businessToken2);
    client.global.set("businessToken2", businessToken2);

    if (response.body.data && response.body.data.businesses && response.body.data.businesses.length > 0) {
        const businessId2 = response.body.data.businesses[0].businessId;
        console.log("업체 2 ID:", businessId2);
        client.global.set("businessId2", businessId2);
    }
%}

### 7. 업체 1 영업시간 설정 (헬스장)
PUT http://localhost:8080/api/schedule/operating-hours?businessId={{businessId1}}
Content-Type: application/json
x-client-token: {{businessToken1}}

{
  "businessHours": [
    {
      "dayOfWeek": 1,
      "openTime": "06:00",
      "closeTime": "22:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 2,
      "openTime": "06:00",
      "closeTime": "22:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 3,
      "openTime": "06:00",
      "closeTime": "22:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 4,
      "openTime": "06:00",
      "closeTime": "22:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 5,
      "openTime": "06:00",
      "closeTime": "22:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 6,
      "openTime": "08:00",
      "closeTime": "20:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 0,
      "openTime": null,
      "closeTime": null,
      "isClosed": true
    }
  ]
}

> {%
    console.log("헬스장 영업시간 설정 완료");
%}

### 8. 업체 2 영업시간 설정 (카페)
PUT http://localhost:8080/api/schedule/operating-hours?businessId={{businessId2}}
Content-Type: application/json
x-client-token: {{businessToken2}}

{
  "businessHours": [
    {
      "dayOfWeek": 1,
      "openTime": "07:00",
      "closeTime": "21:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 2,
      "openTime": "07:00",
      "closeTime": "21:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 3,
      "openTime": "07:00",
      "closeTime": "21:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 4,
      "openTime": "07:00",
      "closeTime": "21:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 5,
      "openTime": "07:00",
      "closeTime": "21:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 6,
      "openTime": "08:00",
      "closeTime": "20:00",
      "isClosed": false
    },
    {
      "dayOfWeek": 0,
      "openTime": "09:00",
      "closeTime": "18:00",
      "isClosed": false
    }
  ]
}

> {%
    console.log("카페 영업시간 설정 완료");
%}

### 9. 헬스장 예약 슬롯 생성 (8월 15일)
POST http://localhost:8080/api/schedule/available-slots?businessId={{businessId1}}
Content-Type: application/json
x-client-token: {{businessToken1}}

{
  "slotDate": "2025-08-15",
  "startTime": "14:00",
  "endTime": "15:00",
  "capacity": 5
}

> {%
    if (response.body.data) {
        client.global.set("gymSlot1", response.body.data.slotId);
        console.log("헬스장 슬롯 1 생성:", response.body.data.slotId);
    }
%}

### 10. 헬스장 예약 슬롯 생성 (9월 10일)
POST http://localhost:8080/api/schedule/available-slots?businessId={{businessId1}}
Content-Type: application/json
x-client-token: {{businessToken1}}

{
  "slotDate": "2025-09-10",
  "startTime": "10:00",
  "endTime": "11:30",
  "capacity": 3
}

> {%
    if (response.body.data) {
        client.global.set("gymSlot2", response.body.data.slotId);
        console.log("헬스장 슬롯 2 생성:", response.body.data.slotId);
    }
%}

### 11. 카페 예약 슬롯 생성 (10월 20일)
POST http://localhost:8080/api/schedule/available-slots?businessId={{businessId2}}
Content-Type: application/json
x-client-token: {{businessToken2}}

{
  "slotDate": "2025-10-20",
  "startTime": "16:00",
  "endTime": "18:00",
  "capacity": 4
}

> {%
    if (response.body.data) {
        client.global.set("cafeSlot1", response.body.data.slotId);
        console.log("카페 슬롯 1 생성:", response.body.data.slotId);
    }
%}

### 12. 카페 예약 슬롯 생성 (10월 5일)
POST http://localhost:8080/api/schedule/available-slots?businessId={{businessId2}}
Content-Type: application/json
x-client-token: {{businessToken2}}

{
  "slotDate": "2025-10-05",
  "startTime": "18:00",
  "endTime": "19:00",
  "capacity": 2
}

> {%
    if (response.body.data) {
        client.global.set("cafeSlot2", response.body.data.slotId);
        console.log("카페 슬롯 2 생성:", response.body.data.slotId);
    }
%}

### 13. 테스트 예약 생성 - 헬스장 8월 예약
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId1}}",
  "availableSlotId": "{{gymSlot1}}",
  "reservationDate": "2025-08-15",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약조회고객",
  "customerPhone": "010-1111-2222",
  "notes": "헬스장 8월 예약"
}

> {%
    if (response.body.data) {
        console.log("✅ 헬스장 8월 예약 생성:", response.body.data.reservationNumber);
    }
%}

### 14. 테스트 예약 생성 - 헬스장 9월 예약
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId1}}",
  "availableSlotId": "{{gymSlot2}}",
  "reservationDate": "2025-09-10",
  "reservationTime": "10:00",
  "durationMinutes": 90,
  "totalPrice": 70000,
  "customerName": "예약조회고객",
  "customerPhone": "010-1111-2222",
  "notes": "헬스장 9월 예약"
}

> {%
    if (response.body.data) {
        console.log("✅ 헬스장 9월 예약 생성:", response.body.data.reservationNumber);
    }
%}

### 15. 테스트 예약 생성 - 카페 10월 예약 (첫 번째)
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId2}}",
  "availableSlotId": "{{cafeSlot1}}",
  "reservationDate": "2025-10-20",
  "reservationTime": "16:00",
  "durationMinutes": 120,
  "totalPrice": 30000,
  "customerName": "예약조회고객",
  "customerPhone": "010-1111-2222",
  "notes": "카페 10월 예약 (첫 번째)"
}

> {%
    if (response.body.data) {
        console.log("✅ 카페 10월 예약 (첫 번째) 생성:", response.body.data.reservationNumber);
    }
%}

### 16. 테스트 예약 생성 - 카페 10월 예약 (두 번째)
POST http://localhost:8080/api/reservations
Content-Type: application/json
x-client-token: {{customerToken}}

{
  "businessId": "{{businessId2}}",
  "availableSlotId": "{{cafeSlot2}}",
  "reservationDate": "2025-10-05",
  "reservationTime": "18:00",
  "durationMinutes": 60,
  "totalPrice": 25000,
  "customerName": "예약조회고객",
  "customerPhone": "010-1111-2222",
  "notes": "카페 10월 예약 (두 번째)"
}

> {%
    if (response.body.data) {
        console.log("✅ 카페 10월 예약 (두 번째) 생성:", response.body.data.reservationNumber);
    }
%}

### 17. 내 예약 목록 조회 - 전체 조회 (필터 없음)
GET http://localhost:8080/api/reservations
x-client-token: {{customerToken}}

> {%
    console.log("전체 예약 조회 응답 상태:", response.status);
    console.log("전체 예약 조회 응답:", JSON.stringify(response.body, null, 2));

    if (response.body.data) {
        console.log("총 예약 수:", response.body.data.reservations ? response.body.data.reservations.length : 0);
        console.log("전체 예약 개수:", response.body.data.pagination ? response.body.data.pagination.totalElements : 0);

        if (response.body.data.reservations) {
            console.log("\n=== 전체 예약 목록 ===");
            response.body.data.reservations.forEach((reservation, index) => {
                console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime} (${reservation.status})`);
            });
        }
    }
%}

### 18. 내 예약 목록 조회 - 상태 필터 (PENDING)
GET http://localhost:8080/api/reservations?status=PENDING
x-client-token: {{customerToken}}

> {%
    if (response.body.data && response.body.data.reservations) {
        console.log("PENDING 예약 수:", response.body.data.reservations.length);
        console.log("\n=== PENDING 예약 목록 ===");
        response.body.data.reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime} (${reservation.status})`);
        });
    }
%}

### 19. 내 예약 목록 조회 - 헬스장 예약만 (업체 필터)
GET http://localhost:8080/api/reservations?businessId={{businessId1}}
x-client-token: {{customerToken}}

> {%
    if (response.body.data && response.body.data.reservations) {
        console.log("헬스장 예약 수:", response.body.data.reservations.length);
        console.log("\n=== 헬스장 예약 목록 ===");
        response.body.data.reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime}`);
        });
    }
%}

### 20. 내 예약 목록 조회 - 카페 예약만 (업체 필터)
GET http://localhost:8080/api/reservations?businessId={{businessId2}}
x-client-token: {{customerToken}}

> {%
    if (response.body.data && response.body.data.reservations) {
        console.log("카페 예약 수:", response.body.data.reservations.length);
        console.log("\n=== 카페 예약 목록 ===");
        response.body.data.reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime}`);
        });
    }
%}

### 21. 내 예약 목록 조회 - 8월 예약만 (날짜 범위 필터)
GET http://localhost:8080/api/reservations?startDate=2025-08-01&endDate=2025-08-31
x-client-token: {{customerToken}}

> {%
    if (response.body.data && response.body.data.reservations) {
        console.log("8월 예약 수:", response.body.data.reservations.length);
        console.log("\n=== 8월 예약 목록 ===");
        response.body.data.reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime}`);
        });
    }
%}

### 22. 내 예약 목록 조회 - 페이징 테스트 (page=0, size=2)
GET http://localhost:8080/api/reservations?page=0&size=2
x-client-token: {{customerToken}}

> {%
    if (response.body.data) {
        console.log("첫 번째 페이지 예약 수:", response.body.data.reservations ? response.body.data.reservations.length : 0);
        console.log("총 예약 수:", response.body.data.pagination ? response.body.data.pagination.totalElements : 0);
        console.log("총 페이지 수:", response.body.data.pagination ? response.body.data.pagination.totalPages : 0);
        console.log("다음 페이지 존재:", response.body.data.pagination ? response.body.data.pagination.hasNext : false);

        if (response.body.data.reservations) {
            console.log("\n=== 첫 번째 페이지 (최신 2개) ===");
            response.body.data.reservations.forEach((reservation, index) => {
                console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime}`);
            });
        }
    }
%}

### 23. 내 예약 목록 조회 - 두 번째 페이지
GET http://localhost:8080/api/reservations?page=1&size=2
x-client-token: {{customerToken}}

> {%
    if (response.body.data) {
        console.log("두 번째 페이지 예약 수:", response.body.data.reservations ? response.body.data.reservations.length : 0);
        console.log("현재 페이지:", response.body.data.pagination ? response.body.data.pagination.currentPage : 0);

        if (response.body.data.reservations) {
            console.log("\n=== 두 번째 페이지 (다음 2개) ===");
            response.body.data.reservations.forEach((reservation, index) => {
                console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime}`);
            });
        }
    }
%}

### 24. 실패 케이스 - 잘못된 상태 값
GET http://localhost:8080/api/reservations?status=INVALID_STATUS
x-client-token: {{customerToken}}

> {%
    console.log("잘못된 상태 값 조회 응답 상태:", response.status);
    if (response.status === 400) {
        console.log("✅ 잘못된 상태 값 검증 성공");
    }
%}

### 25. 실패 케이스 - 잘못된 날짜 형식
GET http://localhost:8080/api/reservations?startDate=invalid-date
x-client-token: {{customerToken}}

> {%
    console.log("잘못된 날짜 형식 조회 응답 상태:", response.status);
    if (response.status === 400) {
        console.log("✅ 잘못된 날짜 형식 검증 성공");
    }
%}

### 26. 검색 결과 없음 테스트 - 미래 날짜 범위
GET http://localhost:8080/api/reservations?startDate=2025-12-01&endDate=2025-12-31
x-client-token: {{customerToken}}

> {%
    if (response.body.data) {
        console.log("미래 날짜 범위 예약 수:", response.body.data.reservations ? response.body.data.reservations.length : 0);
        if (response.body.data.pagination && response.body.data.pagination.totalElements === 0) {
            console.log("✅ 검색 결과 없음 케이스 정상 처리");
        }
    }
%}

### 27. 정렬 확인 테스트 - 날짜 내림차순 확인
GET http://localhost:8080/api/reservations?size=10
x-client-token: {{customerToken}}

> {%
    if (response.body.data && response.body.data.reservations) {
        console.log("\n=== 예약 날짜 정렬 순서 확인 ===");
        response.body.data.reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime}`);
        });

        // 정렬 순서 검증 (날짜 내림차순)
        const dates = response.body.data.reservations.map(r => r.reservationDate);
        let isSorted = true;
        for (let i = 0; i < dates.length - 1; i++) {
            if (dates[i] < dates[i + 1]) {
                isSorted = false;
                break;
            }
        }

        if (isSorted) {
            console.log("✅ 날짜 내림차순 정렬 확인");
        } else {
            console.log("⚠️ 정렬 순서가 올바르지 않음");
        }
    }
%}
