### 예약 조회 API 테스트 (핵심 기능) - 고객 권한

### 1. 고객 회원가입 (예약 조회자)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "my-reservations@timefit.com",
  "password": "SecureP@ss123!",
  "name": "예약조회고객",
  "phoneNumber": "010-1111-2222"
}

> {%
    client.test("고객 회원가입 성공", function() {
        client.assert(response.status === 201, "응답 코드가 201이어야 함");
        client.assert(response.headers.valueOf("Authorization"), "Authorization 헤더가 있어야 함");
    });

    const customerAuthHeader = response.headers.valueOf("Authorization");
    client.global.set("customerAuthHeader", customerAuthHeader);
    console.log("고객 회원가입 성공");
%}

### 2. 업체 1 회원가입 (헬스장)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "gym-business@timefit.com",
  "password": "SecureP@ss123!",
  "name": "헬스장사장",
  "phoneNumber": "010-2222-3333"
}

> {%
    const gymAuthHeader = response.headers.valueOf("Authorization");
    client.global.set("gymAuthHeader", gymAuthHeader);
    console.log("헬스장 회원가입 성공");
%}

### 3. 업체 2 회원가입 (카페)
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "cafe-business@timefit.com",
  "password": "SecureP@ss123!",
  "name": "카페사장",
  "phoneNumber": "010-3333-4444"
}

> {%
    const cafeAuthHeader = response.headers.valueOf("Authorization");
    client.global.set("cafeAuthHeader", cafeAuthHeader);
    console.log("카페 회원가입 성공");
%}

### 4. 헬스장 업체 생성
POST http://localhost:8080/api/business
Content-Type: application/json
Authorization: {{gymAuthHeader}}

{
  "businessName": "파워 헬스장",
  "businessType": "헬스장",
  "businessNumber": "222-22-22222",
  "address": "서울시 강남구 헬스로 222",
  "contactPhone": "02-2222-2222",
  "description": "최고의 헬스장입니다"
}

> {%
    if (response.body.data) {
        const businessId1 = response.body.data.businessId;
        console.log("헬스장 생성 성공:", businessId1);
        client.global.set("businessId1", businessId1);
    }
%}

### 5. 카페 업체 생성
POST http://localhost:8080/api/business
Content-Type: application/json
Authorization: {{cafeAuthHeader}}

{
  "businessName": "아늑한 카페",
  "businessType": "카페",
  "businessNumber": "333-33-33333",
  "address": "서울시 홍대구 카페로 333",
  "contactPhone": "02-3333-3333",
  "description": "편안한 분위기의 카페입니다"
}

> {%
    if (response.body.data) {
        const businessId2 = response.body.data.businessId;
        console.log("카페 생성 성공:", businessId2);
        client.global.set("businessId2", businessId2);
    }
%}

### 6. 헬스장 영업시간 설정
PUT http://localhost:8080/api/schedule/operating-hours?businessId={{businessId1}}
Content-Type: application/json
Authorization: {{gymAuthHeader}}

{
  "businessHours": [
    {"dayOfWeek": 1, "openTime": "06:00", "closeTime": "23:00", "isClosed": false},
    {"dayOfWeek": 2, "openTime": "06:00", "closeTime": "23:00", "isClosed": false},
    {"dayOfWeek": 3, "openTime": "06:00", "closeTime": "23:00", "isClosed": false},
    {"dayOfWeek": 4, "openTime": "06:00", "closeTime": "23:00", "isClosed": false},
    {"dayOfWeek": 5, "openTime": "06:00", "closeTime": "23:00", "isClosed": false},
    {"dayOfWeek": 6, "openTime": "08:00", "closeTime": "20:00", "isClosed": false},
    {"dayOfWeek": 0, "openTime": null, "closeTime": null, "isClosed": true}
  ]
}

> {%
    console.log("헬스장 영업시간 설정 완료");
%}

### 7. 카페 영업시간 설정
PUT http://localhost:8080/api/schedule/operating-hours?businessId={{businessId2}}
Content-Type: application/json
Authorization: {{cafeAuthHeader}}

{
  "businessHours": [
    {"dayOfWeek": 1, "openTime": "08:00", "closeTime": "22:00", "isClosed": false},
    {"dayOfWeek": 2, "openTime": "08:00", "closeTime": "22:00", "isClosed": false},
    {"dayOfWeek": 3, "openTime": "08:00", "closeTime": "22:00", "isClosed": false},
    {"dayOfWeek": 4, "openTime": "08:00", "closeTime": "22:00", "isClosed": false},
    {"dayOfWeek": 5, "openTime": "08:00", "closeTime": "22:00", "isClosed": false},
    {"dayOfWeek": 6, "openTime": "09:00", "closeTime": "23:00", "isClosed": false},
    {"dayOfWeek": 0, "openTime": "09:00", "closeTime": "21:00", "isClosed": false}
  ]
}

> {%
    console.log("카페 영업시간 설정 완료");
%}

### 8. 헬스장 예약 슬롯 생성
POST http://localhost:8080/api/schedule/available-slots?businessId={{businessId1}}
Content-Type: application/json
Authorization: {{gymAuthHeader}}

{
  "slots": [
    {"slotDate": "2026-08-15", "startTime": "07:00", "endTime": "08:00", "capacity": 8},
    {"slotDate": "2026-08-15", "startTime": "19:00", "endTime": "20:00", "capacity": 6},
    {"slotDate": "2026-09-10", "startTime": "10:00", "endTime": "11:30", "capacity": 5}
  ]
}

> {%
    if (response.status === 201 && response.body.data && response.body.data.createdSlots && response.body.data.createdSlots.length >= 3) {
        const gymSlot1 = response.body.data.createdSlots[0];
        const gymSlot2 = response.body.data.createdSlots[1];
        const gymSlot3 = response.body.data.createdSlots[2];

        client.global.set("gymSlot1Id", gymSlot1.slotId);
        client.global.set("gymSlot2Id", gymSlot2.slotId);
        client.global.set("gymSlot3Id", gymSlot3.slotId);

        console.log("✅ 헬스장 슬롯 3개 생성 완료");
    }
%}

### 9. 카페 예약 슬롯 생성
POST http://localhost:8080/api/schedule/available-slots?businessId={{businessId2}}
Content-Type: application/json
Authorization: {{cafeAuthHeader}}

{
  "slots": [
    {"slotDate": "2026-10-05", "startTime": "14:00", "endTime": "15:00", "capacity": 4},
    {"slotDate": "2026-10-20", "startTime": "16:00", "endTime": "18:00", "capacity": 3}
  ]
}

> {%
    if (response.status === 201 && response.body.data && response.body.data.createdSlots && response.body.data.createdSlots.length >= 2) {
        const cafeSlot1 = response.body.data.createdSlots[0];
        const cafeSlot2 = response.body.data.createdSlots[1];

        client.global.set("cafeSlot1Id", cafeSlot1.slotId);
        client.global.set("cafeSlot2Id", cafeSlot2.slotId);

        console.log("✅ 카페 슬롯 2개 생성 완료");
    }
%}

### 10. 테스트용 예약 생성 - 헬스장 8월 예약
POST http://localhost:8080/api/reservation
Content-Type: application/json
Authorization: {{customerAuthHeader}}

{
  "businessId": "{{businessId1}}",
  "availableSlotId": "{{gymSlot1Id}}",
  "reservationDate": "2026-08-15",
  "reservationTime": "07:00",
  "durationMinutes": 60,
  "totalPrice": 50000,
  "customerName": "예약조회고객",
  "customerPhone": "010-1111-2222",
  "notes": "헬스장 아침 운동 예약"
}

> {%
    if (response.status === 201 && response.body.data) {
        console.log("✅ 헬스장 8월 예약 생성:", response.body.data.reservationNumber);
        client.global.set("reservation1Id", response.body.data.reservationId);
    }
%}

### 11. 테스트용 예약 생성 - 헬스장 9월 예약
POST http://localhost:8080/api/reservation
Content-Type: application/json
Authorization: {{customerAuthHeader}}

{
  "businessId": "{{businessId1}}",
  "availableSlotId": "{{gymSlot3Id}}",
  "reservationDate": "2026-09-10",
  "reservationTime": "10:00",
  "durationMinutes": 90,
  "totalPrice": 70000,
  "customerName": "예약조회고객",
  "customerPhone": "010-1111-2222",
  "notes": "헬스장 9월 예약"
}

> {%
    if (response.status === 201 && response.body.data) {
        console.log("✅ 헬스장 9월 예약 생성:", response.body.data.reservationNumber);
        client.global.set("reservation2Id", response.body.data.reservationId);
    }
%}

### 12. 테스트용 예약 생성 - 카페 10월 예약 (첫 번째)
POST http://localhost:8080/api/reservation
Content-Type: application/json
Authorization: {{customerAuthHeader}}

{
  "businessId": "{{businessId2}}",
  "availableSlotId": "{{cafeSlot2Id}}",
  "reservationDate": "2026-10-20",
  "reservationTime": "16:00",
  "durationMinutes": 120,
  "totalPrice": 30000,
  "customerName": "예약조회고객",
  "customerPhone": "010-1111-2222",
  "notes": "카페 10월 예약 (첫 번째)"
}

> {%
    if (response.status === 201 && response.body.data) {
        console.log("✅ 카페 10월 예약 (첫 번째) 생성:", response.body.data.reservationNumber);
        client.global.set("reservation3Id", response.body.data.reservationId);
    }
%}

### 13. 테스트용 예약 생성 - 카페 10월 예약 (두 번째)
POST http://localhost:8080/api/reservation
Content-Type: application/json
Authorization: {{customerAuthHeader}}

{
  "businessId": "{{businessId2}}",
  "availableSlotId": "{{cafeSlot1Id}}",
  "reservationDate": "2026-10-05",
  "reservationTime": "14:00",
  "durationMinutes": 60,
  "totalPrice": 25000,
  "customerName": "예약조회고객",
  "customerPhone": "010-1111-2222",
  "notes": "카페 10월 예약 (두 번째)"
}

> {%
    if (response.status === 201 && response.body.data) {
        console.log("✅ 카페 10월 예약 (두 번째) 생성:", response.body.data.reservationNumber);
        client.global.set("reservation4Id", response.body.data.reservationId);
    }
%}

### 14. ✅ 성공 케이스 - 내 예약 목록 전체 조회 (필터 없음)
GET http://localhost:8080/api/reservation
Authorization: {{customerAuthHeader}}

> {%
    console.log("=== 내 예약 목록 전체 조회 ===");
    console.log("응답 상태:", response.status);
    console.log("응답 본문:", JSON.stringify(response.body, null, 2));

    client.test("내 예약 목록 조회 성공", function() {
        client.assert(response.status === 200, "응답 코드가 200이어야 함");
        client.assert(response.body.success === true, "success가 true여야 함");
        client.assert(response.body.data, "응답 데이터가 있어야 함");
    });

    if (response.status === 200 && response.body.data && response.body.data.reservations) {
        const reservations = response.body.data.reservations;
        console.log("✅ 내 예약 목록 조회 성공");
        console.log("총 예약 수:", reservations.length);

        if (response.body.data.pagination) {
            console.log("전체 예약 개수:", response.body.data.pagination.totalElements);
        }

        console.log("\n=== 전체 예약 목록 ===");
        reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime} (${reservation.status})`);
            console.log(`   예약번호: ${reservation.reservationNumber}, 가격: ${reservation.totalPrice}원`);
        });

        if (reservations.length === 4) {
            console.log("✅ 4개의 예약이 모두 조회됨");
        }

        // 정렬 확인 (최신순 - 날짜 내림차순)
        if (reservations.length > 1) {
            const dates = reservations.map(r => r.reservationDate);
            let isSorted = true;
            for (let i = 0; i < dates.length - 1; i++) {
                if (dates[i] < dates[i + 1]) {
                    isSorted = false;
                    break;
                }
            }
            console.log("예약 정렬:", isSorted ? "최신순 정렬 확인" : "정렬 순서 확인 필요");
        }
    } else {
        console.log("❌ 내 예약 목록 조회 실패");
    }
%}

### 15. ✅ 성공 케이스 - 상태별 필터링 조회 (PENDING)
GET http://localhost:8080/api/reservation?status=PENDING
Authorization: {{customerAuthHeader}}

> {%
    console.log("=== 상태별 예약 조회 (PENDING) ===");
    console.log("응답 상태:", response.status);

    if (response.status === 200 && response.body.data && response.body.data.reservations) {
        const reservations = response.body.data.reservations;
        console.log("✅ 상태별 예약 조회 성공");
        console.log("PENDING 상태 예약 수:", reservations.length);

        const allPending = reservations.every(r => r.status === "PENDING");
        if (allPending) {
            console.log("✅ 상태 필터링이 올바르게 작동함");
        } else {
            console.log("⚠️ 상태 필터링 확인 필요");
        }

        console.log("\n=== PENDING 예약 목록 ===");
        reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime}`);
        });
    }
%}

### 16. ✅ 성공 케이스 - 업체별 필터링 조회 (헬스장만)
GET http://localhost:8080/api/reservation?businessId={{businessId1}}
Authorization: {{customerAuthHeader}}

> {%
    console.log("=== 업체별 예약 조회 (헬스장만) ===");
    console.log("응답 상태:", response.status);

    if (response.status === 200 && response.body.data && response.body.data.reservations) {
        const reservations = response.body.data.reservations;
        console.log("✅ 업체별 예약 조회 성공");
        console.log("헬스장 예약 수:", reservations.length);

        const allGym = reservations.every(r => r.businessName === "파워 헬스장");
        if (allGym) {
            console.log("✅ 업체 필터링이 올바르게 작동함");
        } else {
            console.log("⚠️ 업체 필터링 확인 필요");
        }

        console.log("\n=== 헬스장 예약 목록 ===");
        reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime}`);
        });
    }
%}

### 17. ✅ 성공 케이스 - 날짜 범위 필터링 조회 (8월)
GET http://localhost:8080/api/reservation?startDate=2026-08-01&endDate=2026-08-31
Authorization: {{customerAuthHeader}}

> {%
    console.log("=== 날짜 범위 예약 조회 (2026년 8월) ===");
    console.log("응답 상태:", response.status);

    if (response.status === 200 && response.body.data && response.body.data.reservations) {
        const reservations = response.body.data.reservations;
        console.log("✅ 날짜 범위 예약 조회 성공");
        console.log("8월 예약 수:", reservations.length);

        const inAugust = reservations.every(r => {
            const reservationDate = r.reservationDate;
            return reservationDate >= "2026-08-01" && reservationDate <= "2026-08-31";
        });

        if (inAugust) {
            console.log("✅ 날짜 범위 필터링이 올바르게 작동함");
        } else {
            console.log("⚠️ 날짜 범위 필터링 확인 필요");
        }

        console.log("\n=== 8월 예약 목록 ===");
        reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.businessName} - ${reservation.reservationDate} ${reservation.reservationTime}`);
        });
    }
%}

### 18. ✅ 성공 케이스 - 특정 날짜 조회
GET http://localhost:8080/api/reservation?date=2026-10-20
Authorization: {{customerAuthHeader}}

> {%
    console.log("=== 특정 날짜 예약 조회 (2026-10-20) ===");
    console.log("응답 상태:", response.status);

    if (response.status === 200 && response.body.data && response.body.data.reservations) {
        const reservations = response.body.data.reservations;
        console.log("✅ 특정 날짜 예약 조회 성공");
        console.log("10월 20일 예약 수:", reservations.length);

        const allSameDate = reservations.every(r => r.reservationDate === "2026-10-20");
        if (allSameDate) {
            console.log("✅ 날짜 필터링이 올바르게 작동함");
        } else {
            console.log("⚠️ 날짜 필터링 확인 필요");
        }

        reservations.forEach((reservation, index) => {
            console.log(`${index + 1}. ${reservation.reservationTime} - ${reservation.businessName}`);
        });
    }
%}

### 19. ✅ 성공 케이스 - 페이징 테스트
GET http://localhost:8080/api/reservation?page=0&size=2
Authorization: {{customerAuthHeader}}

> {%
    console.log("=== 페이징 테스트 (page=0, size=2) ===");
    console.log("응답 상태:", response.status);

    if (response.status === 200 && response.body.data) {
        console.log("✅ 페이징 조회 성공");

        if (response.body.data.reservations) {
            console.log("조회된 예약 수:", response.body.data.reservations.length);

            // 페이지 크기 확인
            if (response.body.data.reservations.length <= 2) {
                console.log("✅ 페이지 크기 제한이 올바르게 작동함");
            }
        }

        if (response.body.data.pagination) {
            console.log("페이징 정보:");
            console.log("- 현재 페이지:", response.body.data.pagination.page);
            console.log("- 페이지 크기:", response.body.data.pagination.size);
            console.log("- 전체 개수:", response.body.data.pagination.totalElements);
            console.log("- 다음 페이지 여부:", response.body.data.pagination.hasNext);
            console.log("- 이전 페이지 여부:", response.body.data.pagination.hasPrevious);
        }
    }
%}

### 20. ❌ 실패 케이스 - 토큰 없이 조회
GET http://localhost:8080/api/reservation

> {%
    client.test("토큰 없는 예약 조회 실패", function() {
        client.assert(response.status === 401, "응답 코드가 401이어야 함");
    });

    console.log("❌ 토큰 없는 예약 조회 차단됨 (401)");
%}

### 21. ❌ 실패 케이스 - 잘못된 토큰으로 조회
GET http://localhost:8080/api/reservation
Authorization: Bearer invalid.token.here

> {%
    client.test("잘못된 토큰 예약 조회 실패", function() {
        client.assert(response.status === 401, "응답 코드가 401이어야 함");
    });

    console.log("❌ 잘못된 토큰 예약 조회 차단됨 (401)");
%}

### 22. ❌ 실패 케이스 - 잘못된 상태 값
GET http://localhost:8080/api/reservation?status=INVALID_STATUS
Authorization: {{customerAuthHeader}}

> {%
    client.test("잘못된 상태 값 조회 실패", function() {
        client.assert(response.status === 400, "응답 코드가 400이어야 함");
    });

    console.log("❌ 잘못된 상태 값 조회 차단됨 (400)");
%}

### 23. ❌ 실패 케이스 - 잘못된 날짜 형식
GET http://localhost:8080/api/reservation?startDate=invalid-date
Authorization: {{customerAuthHeader}}

> {%
    client.test("잘못된 날짜 형식 조회 실패", function() {
        client.assert(response.status === 400, "응답 코드가 400이어야 함");
    });

    console.log("❌ 잘못된 날짜 형식 조회 차단됨 (400)");
%}

### 24. ✅ 성공 케이스 - 검색 결과 없음 테스트 (미래 날짜 범위)
GET http://localhost:8080/api/reservation?startDate=2027-01-01&endDate=2027-12-31
Authorization: {{customerAuthHeader}}

> {%
    console.log("=== 검색 결과 없음 테스트 (2027년) ===");
    console.log("응답 상태:", response.status);

    if (response.status === 200 && response.body.data) {
        const reservationCount = response.body.data.reservations ? response.body.data.reservations.length : 0;
        console.log("2027년 예약 수:", reservationCount);

        if (response.body.data.pagination && response.body.data.pagination.totalElements === 0) {
            console.log("✅ 검색 결과 없음 케이스 정상 처리");
        }
    }
%}

### 25. ❌ 실패 케이스 - 다른 사용자가 조회 시도
POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "email": "another-customer@timefit.com",
  "password": "SecureP@ss123!",
  "name": "다른고객",
  "phoneNumber": "010-4444-5555"
}

> {%
    const anotherCustomerAuthHeader = response.headers.valueOf("Authorization");
    client.global.set("anotherCustomerAuthHeader", anotherCustomerAuthHeader);
    console.log("다른 고객 생성 완료");
%}
