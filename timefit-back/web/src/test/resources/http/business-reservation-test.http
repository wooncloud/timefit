### ================================================================
### Timefit ì˜ˆì•½ Happy Path í…ŒìŠ¤íŠ¸ - ìµœì†Œ ì‹œë‚˜ë¦¬ì˜¤
### ================================================================
###
### í…ŒìŠ¤íŠ¸ ìˆœì„œ:
### [Setup 1] ì‚¬ì¥ íšŒì›ê°€ì… + ë¡œê·¸ì¸
### [Setup 2] ì—…ì²´ ìƒì„±
### [Setup 3] ì˜ì—…ì‹œê°„ ì„¤ì •
### [Setup 4] ì¹´í…Œê³ ë¦¬ ìƒì„±
### [Setup 5] ë©”ë‰´ ìƒì„± (í—¤ì–´ì»· 60ë¶„)
### [Setup 6] BookingSlot ì¡°íšŒ
### [Setup 7] ê³ ê° íšŒì›ê°€ì… + ë¡œê·¸ì¸
### [Test 1] ì˜ˆì•½ ìƒì„± (ê³ ê°)
### [Test 2] ì—…ì²´ ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ (ì‚¬ì¥)
### [Test 3] ê³ ê° ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ (ê³ ê°)
###
### ================================================================

@baseUrl = http://localhost:8080

### ================================================================
### [Setup 1-1] ì‚¬ì¥ íšŒì›ê°€ì…
### ================================================================

# @name ì‚¬ì¥íšŒì›ê°€ì…
POST {{baseUrl}}/api/auth/signup
Content-Type: application/json

{
  "email": "owner@happypath.com",
  "password": "test1234!",
  "name": "ê¹€ì‚¬ì¥",
  "phoneNumber": "010-1111-2222",
  "role": "BUSINESS"
}

> {%
    console.log("\n========================================");
    console.log("[Setup 1-1] ì‚¬ì¥ íšŒì›ê°€ì…");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200 || response.status === 201) {
        console.log("âœ… ì‚¬ì¥ íšŒì›ê°€ì… ì„±ê³µ");
        console.log("   Email: owner@happypath.com");
        console.log("   Role: BUSINESS");
    } else {
        console.error("âŒ ì‚¬ì¥ íšŒì›ê°€ì… ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Setup 1-2] ì‚¬ì¥ ë¡œê·¸ì¸
### ================================================================

# @name ì‚¬ì¥ë¡œê·¸ì¸
POST {{baseUrl}}/api/auth/signin
Content-Type: application/json

{
  "email": "owner@happypath.com",
  "password": "test1234!"
}

> {%
    console.log("\n========================================");
    console.log("[Setup 1-2] ì‚¬ì¥ ë¡œê·¸ì¸");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200 && response.body.data && response.body.data.accessToken) {
        client.global.set("ownerToken", response.body.data.accessToken);
        console.log("âœ… ì‚¬ì¥ ë¡œê·¸ì¸ ì„±ê³µ");
        console.log("   Token ì €ì¥ ì™„ë£Œ");
        console.log("   User ID:", response.body.data.userId);
    } else {
        console.error("âŒ ì‚¬ì¥ ë¡œê·¸ì¸ ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Setup 2] ì—…ì²´ ìƒì„±
### ================================================================

# @name ì—…ì²´ìƒì„±
POST {{baseUrl}}/api/business
Content-Type: application/json
Authorization: Bearer {{ownerToken}}

{
  "businessName": "HappyPath í—¤ì–´ìƒµ",
  "businessTypes": ["BD008"],
  "businessNumber": "123-45-67890",
  "ownerName": "ê¹€ì‚¬ì¥",
  "address": "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 1",
  "contactPhone": "02-1111-2222",
  "description": "ìµœì†Œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í—¤ì–´ìƒµì…ë‹ˆë‹¤."
}

> {%
    console.log("\n========================================");
    console.log("[Setup 2] ì—…ì²´ ìƒì„±");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200 || response.status === 201) {
        if (response.body.data && response.body.data.businessId) {
            client.global.set("businessId", response.body.data.businessId);
            console.log("âœ… ì—…ì²´ ìƒì„± ì„±ê³µ");
            console.log("   Business ID:", response.body.data.businessId);
            console.log("   ì—…ì²´ëª…:", response.body.data.businessName);
        } else {
            console.error("âŒ ì‘ë‹µ êµ¬ì¡° ì˜¤ë¥˜:", response.body);
        }
    } else {
        console.error("âŒ ì—…ì²´ ìƒì„± ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Setup 3] ì˜ì—…ì‹œê°„ ì„¤ì • (ì›”~ê¸ˆ 09:00-18:00)
### ================================================================

# @name ì˜ì—…ì‹œê°„ì„¤ì •
PUT {{baseUrl}}/api/business/{{businessId}}/operating-hours
Content-Type: application/json
Authorization: Bearer {{ownerToken}}

{
  "schedules": [
    {
      "dayOfWeek": 1,
      "openTime": "09:00",
      "closeTime": "18:00",
      "isClosed": false,
      "bookingTimeRanges": [
        {"startTime": "09:00", "endTime": "18:00"}
      ]
    },
    {
      "dayOfWeek": 2,
      "openTime": "09:00",
      "closeTime": "18:00",
      "isClosed": false,
      "bookingTimeRanges": [
        {"startTime": "09:00", "endTime": "18:00"}
      ]
    },
    {
      "dayOfWeek": 3,
      "openTime": "09:00",
      "closeTime": "18:00",
      "isClosed": false,
      "bookingTimeRanges": [
        {"startTime": "09:00", "endTime": "18:00"}
      ]
    },
    {
      "dayOfWeek": 4,
      "openTime": "09:00",
      "closeTime": "18:00",
      "isClosed": false,
      "bookingTimeRanges": [
        {"startTime": "09:00", "endTime": "18:00"}
      ]
    },
    {
      "dayOfWeek": 5,
      "openTime": "09:00",
      "closeTime": "18:00",
      "isClosed": false,
      "bookingTimeRanges": [
        {"startTime": "09:00", "endTime": "18:00"}
      ]
    },
    {
      "dayOfWeek": 6,
      "isClosed": true,
      "bookingTimeRanges": []
    },
    {
      "dayOfWeek": 0,
      "isClosed": true,
      "bookingTimeRanges": []
    }
  ]
}

> {%
    console.log("\n========================================");
    console.log("[Setup 3] ì˜ì—…ì‹œê°„ ì„¤ì •");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200) {
        console.log("âœ… ì˜ì—…ì‹œê°„ ì„¤ì • ì„±ê³µ");
        console.log("   ì›”~ê¸ˆ: 09:00-18:00");
        console.log("   í† ~ì¼: íœ´ë¬´");
    } else {
        console.error("âŒ ì˜ì—…ì‹œê°„ ì„¤ì • ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Setup 4] ì¹´í…Œê³ ë¦¬ ìƒì„± (Hair)
### ================================================================

# @name ì¹´í…Œê³ ë¦¬ìƒì„±
POST {{baseUrl}}/api/business/{{businessId}}/category
Content-Type: application/json
Authorization: Bearer {{ownerToken}}

{
  "businessType": "BD008",
  "categoryName": "Hair"
}

> {%
    console.log("\n========================================");
    console.log("[Setup 4] ì¹´í…Œê³ ë¦¬ ìƒì„±");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200 || response.status === 201) {
        if (response.body.data && response.body.data.categoryId) {
            client.global.set("businessCategoryId", response.body.data.categoryId);
            console.log("âœ… ì¹´í…Œê³ ë¦¬ ìƒì„± ì„±ê³µ");
            console.log("   Category ID:", response.body.data.categoryId);
            console.log("   Type: BD008 (BEAUTY)");
            console.log("   Name: Hair");
        } else {
            console.error("âŒ ì‘ë‹µ êµ¬ì¡° ì˜¤ë¥˜:", response.body);
        }
    } else {
        console.error("âŒ ì¹´í…Œê³ ë¦¬ ìƒì„± ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Setup 5] í—¤ì–´ì»· ë©”ë‰´ ìƒì„± (60ë¶„)
### ================================================================

# @name í—¤ì–´ì»·ë©”ë‰´ìƒì„±
POST {{baseUrl}}/api/business/{{businessId}}/menu
Content-Type: application/json
Authorization: Bearer {{ownerToken}}

{
  "businessType": "BD008",
  "categoryName": "Hair",
  "serviceName": "í—¤ì–´ì»·",
  "description": "ê¸°ë³¸ ì»¤íŠ¸ ì„œë¹„ìŠ¤",
  "price": 30000,
  "durationMinutes": 60,
  "orderType": "RESERVATION_BASED",
  "autoGenerateSlots": true,
  "slotSettings": {
    "startDate": "2026-01-20",
    "endDate": "2026-01-31",
    "slotIntervalMinutes": 60,
    "specificTimeRanges": [
      {"startTime": "09:00", "endTime": "18:00"}
    ]
  }
}

> {%
    console.log("\n========================================");
    console.log("[Setup 5] í—¤ì–´ì»· ë©”ë‰´ ìƒì„±");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200 || response.status === 201) {
        if (response.body.data && response.body.data.menuId) {
            client.global.set("haircutMenuId", response.body.data.menuId);
            console.log("âœ… í—¤ì–´ì»· ë©”ë‰´ ìƒì„± ì„±ê³µ");
            console.log("   Menu ID:", response.body.data.menuId);
            console.log("   ë©”ë‰´ëª…: í—¤ì–´ì»·");
            console.log("   ê°€ê²©: 30,000ì›");
            console.log("   ì†Œìš”ì‹œê°„: 60ë¶„");
        } else {
            console.error("âŒ ì‘ë‹µ êµ¬ì¡° ì˜¤ë¥˜:", response.body);
        }
    } else {
        console.error("âŒ í—¤ì–´ì»· ë©”ë‰´ ìƒì„± ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Setup 6] BookingSlot ì¡°íšŒ - ë‹¤ìŒ ì£¼ ì›”ìš”ì¼
### ================================================================

# @name BookingSlotì¡°íšŒ
GET {{baseUrl}}/api/business/{{businessId}}/booking-slot?date=2026-01-20
Authorization: Bearer {{ownerToken}}

> {%
    console.log("\n========================================");
    console.log("[Setup 6] BookingSlot ì¡°íšŒ");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200) {
        const slotsData = response.body.data;
        const slots = slotsData.slots; // ë°°ì—´ ì¶”ì¶œ

        console.log("âœ… ìŠ¬ë¡¯ ì¡°íšŒ ì„±ê³µ");
        console.log("   ì´ ìŠ¬ë¡¯ ìˆ˜:", slots.length);

        // ì²« ë²ˆì§¸ ìŠ¬ë¡¯ì˜ ID ì €ì¥ (09:00 ìŠ¬ë¡¯)
        if (slots && slots.length > 0) {
            const firstSlotId = slots[0].slotId;
            client.global.set("haircutSlot_09_00", firstSlotId);
            console.log("\nâœ… ì²« ë²ˆì§¸ ìŠ¬ë¡¯ ID ì €ì¥");
            console.log("   Slot ID:", firstSlotId);
            console.log("   ì‹œê°„:", slots[0].startTime, "~", slots[0].endTime);
        } else {
            console.error("âŒ ìŠ¬ë¡¯ì´ ì—†ìŠµë‹ˆë‹¤");
        }
    } else {
        console.error("âŒ ìŠ¬ë¡¯ ì¡°íšŒ ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Setup 7-1] ê³ ê° íšŒì›ê°€ì…
### ================================================================

# @name ê³ ê°íšŒì›ê°€ì…
POST {{baseUrl}}/api/auth/signup
Content-Type: application/json

{
  "email": "customer@happypath.com",
  "password": "test1234!",
  "name": "ê¹€ê³ ê°",
  "phoneNumber": "010-3333-4444",
  "role": "CUSTOMER"
}

> {%
    console.log("\n========================================");
    console.log("[Setup 7-1] ê³ ê° íšŒì›ê°€ì…");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200 || response.status === 201) {
        console.log("âœ… ê³ ê° íšŒì›ê°€ì… ì„±ê³µ");
        console.log("   Email: customer@happypath.com");
        console.log("   Role: CUSTOMER");
    } else {
        console.error("âŒ ê³ ê° íšŒì›ê°€ì… ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Setup 7-2] ê³ ê° ë¡œê·¸ì¸
### ================================================================

# @name ê³ ê°ë¡œê·¸ì¸
POST {{baseUrl}}/api/auth/signin
Content-Type: application/json

{
  "email": "customer@happypath.com",
  "password": "test1234!"
}

> {%
    console.log("\n========================================");
    console.log("[Setup 7-2] ê³ ê° ë¡œê·¸ì¸");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200 && response.body.data && response.body.data.accessToken) {
        client.global.set("customerToken", response.body.data.accessToken);
        console.log("âœ… ê³ ê° ë¡œê·¸ì¸ ì„±ê³µ");
        console.log("   Token ì €ì¥ ì™„ë£Œ");
        console.log("   User ID:", response.body.data.userId);
    } else {
        console.error("âŒ ê³ ê° ë¡œê·¸ì¸ ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Test 1] ì˜ˆì•½ ìƒì„± (ê³ ê°)
### ================================================================

# @name ì˜ˆì•½ìƒì„±
POST {{baseUrl}}/api/reservation
Content-Type: application/json
Authorization: Bearer {{customerToken}}

{
  "businessId": "{{businessId}}",
  "menuId": "{{haircutMenuId}}",
  "bookingSlotId": "{{haircutSlot_09_00}}",
  "durationMinutes": 60,
  "totalPrice": 30000,
  "customerName": "ê¹€ê³ ê°",
  "customerPhone": "01033334444",
  "notes": "í—¤ì–´ì»· ì˜ˆì•½ì…ë‹ˆë‹¤"
}

> {%
    console.log("\n========================================");
    console.log("[Test 1] ì˜ˆì•½ ìƒì„± (ê³ ê°)");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200 || response.status === 201) {
        if (response.body.data && response.body.data.reservationId) {
            client.global.set("reservationId", response.body.data.reservationId);
            console.log("âœ… ì˜ˆì•½ ìƒì„± ì„±ê³µ");
            console.log("   Reservation ID:", response.body.data.reservationId);
            console.log("   ë©”ë‰´: í—¤ì–´ì»·");
            console.log("   ì‹œê°„ëŒ€: 09:00-10:00");
            console.log("   ê°€ê²©: 30,000ì›");
            console.log("   ìƒíƒœ:", response.body.data.status);
        } else {
            console.error("âŒ ì‘ë‹µ êµ¬ì¡° ì˜¤ë¥˜:", response.body);
        }
    } else {
        console.error("âŒ ì˜ˆì•½ ìƒì„± ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Test 2] ì—…ì²´ ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ (ì‚¬ì¥) - ì§€ê¸ˆ í…ŒìŠ¤íŠ¸í•˜ë ¤ëŠ” API
### ================================================================

# @name ì—…ì²´ì˜ˆì•½ëª©ë¡ì¡°íšŒ
GET {{baseUrl}}/api/business/{{businessId}}/reservations?status=PENDING&startDate=2026-01-01&endDate=2026-12-31&page=0&size=20
Authorization: Bearer {{ownerToken}}

> {%
    console.log("\n========================================");
    console.log("[Test 2] ì—…ì²´ ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ (ì‚¬ì¥)");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200) {
        const data = response.body.data;
        console.log("âœ… ì—…ì²´ ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ ì„±ê³µ");
        console.log("   ì´ ì˜ˆì•½ ìˆ˜:", data.totalElements || data.length);

        if (data.content && data.content.length > 0) {
            console.log("\n=== ì˜ˆì•½ ëª©ë¡ ===");
            data.content.forEach((reservation, idx) => {
                console.log(`\n[${idx + 1}] Reservation ID:`, reservation.reservationId);
                console.log("   ê³ ê°ëª…:", reservation.customerName);
                console.log("   ë©”ë‰´:", reservation.menuName);
                console.log("   ì‹œê°„:", reservation.startTime, "~", reservation.endTime);
                console.log("   ìƒíƒœ:", reservation.status);
            });
        } else if (Array.isArray(data) && data.length > 0) {
            console.log("\n=== ì˜ˆì•½ ëª©ë¡ ===");
            data.forEach((reservation, idx) => {
                console.log(`\n[${idx + 1}] Reservation ID:`, reservation.reservationId);
                console.log("   ê³ ê°ëª…:", reservation.customerName);
                console.log("   ë©”ë‰´:", reservation.menuName);
                console.log("   ì‹œê°„:", reservation.startTime, "~", reservation.endTime);
                console.log("   ìƒíƒœ:", reservation.status);
            });
        } else {
            console.log("   ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.");
        }
    } else {
        console.error("âŒ ì—…ì²´ ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}

### ================================================================
### [Test 3] ê³ ê° ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ (ê³ ê°)
### ================================================================

# @name ê³ ê°ì˜ˆì•½ëª©ë¡ì¡°íšŒ
GET {{baseUrl}}/api/reservations
Authorization: Bearer {{customerToken}}

> {%
    console.log("\n========================================");
    console.log("[Test 3] ê³ ê° ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ (ê³ ê°)");
    console.log("========================================");
    console.log("Status:", response.status);

    if (response.status === 200) {
        const reservations = response.body.data;
        console.log("âœ… ê³ ê° ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ ì„±ê³µ");
        console.log("   ì´ ì˜ˆì•½ ìˆ˜:", reservations.length);

        if (reservations.length > 0) {
            console.log("\n=== ë‚´ ì˜ˆì•½ ëª©ë¡ ===");
            reservations.forEach((reservation, idx) => {
                console.log(`\n[${idx + 1}] Reservation ID:`, reservation.reservationId);
                console.log("   ì—…ì²´:", reservation.businessName);
                console.log("   ë©”ë‰´:", reservation.menuName);
                console.log("   ë‚ ì§œ:", reservation.reservationDate);
                console.log("   ì‹œê°„:", reservation.startTime, "~", reservation.endTime);
                console.log("   ìƒíƒœ:", reservation.status);
            });
        } else {
            console.log("   ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.");
        }

        console.log("\n========================================");
        console.log("ğŸ‰ Happy Path í…ŒìŠ¤íŠ¸ ì™„ë£Œ!");
        console.log("========================================");
        console.log("âœ… Setup: ì‚¬ì¥ ê°€ì… â†’ ì—…ì²´ ìƒì„± â†’ ì˜ì—…ì‹œê°„ â†’ ì¹´í…Œê³ ë¦¬ â†’ ë©”ë‰´");
        console.log("âœ… Setup: ê³ ê° ê°€ì… â†’ ë¡œê·¸ì¸");
        console.log("âœ… Test 1: ì˜ˆì•½ ìƒì„± (ê³ ê°)");
        console.log("âœ… Test 2: ì—…ì²´ ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ (ì‚¬ì¥)");
        console.log("âœ… Test 3: ê³ ê° ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ (ê³ ê°)");
    } else {
        console.error("âŒ ê³ ê° ì˜ˆì•½ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨");
        console.error("   ì—ëŸ¬:", JSON.stringify(response.body, null, 2));
    }
%}
