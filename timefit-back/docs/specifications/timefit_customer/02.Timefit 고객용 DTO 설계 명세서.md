# 02. ê³ ê° DTO ì„¤ê³„ ëª…ì„¸ì„œ

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ëŒ€ìƒ**: ê³ ê°ìš© API ê°œë°œ
- **ë²”ìœ„**: Request/Response DTO

---

## ğŸ¯ DTO ì„¤ê³„ ì›ì¹™

### 1. Record íŒ¨í„´ ì‚¬ìš©
```
Java 17+ record íŒ¨í„´ ì‚¬ìš©
- ë¶ˆë³€ ê°ì²´ (Immutable)
- ê°„ê²°í•œ ì„ ì–¸
- ìë™ equals/hashCode/toString
```

### 2. ë„¤ì´ë° ê·œì¹™

#### Response DTO
```
ë‹¨ì¼ ê°ì²´: {Domain}Response
- BusinessDetailResponse
- MenuDetailResponse
- ReviewResponse

ëª©ë¡: {Domain}ListResponse
- BusinessListResponse (List ë°˜í™˜ ì‹œ)
- MenuListResponse
- ReviewListResponse
```

#### Request DTO
```
Create: Create{Domain}Request
Update: Update{Domain}Request
Delete: Delete{Domain}Request (í•„ìš” ì‹œ)
```

### 3. ë³µìˆ˜í˜• ê·œì¹™
```
ì—”ë“œí¬ì¸íŠ¸ì™€ ì¼ì¹˜:
- GET /api/menus â†’ MenuListResponse { List<MenuSummary> menus }
- GET /api/menu/{id} â†’ MenuDetailResponse
- GET /api/reviews â†’ ReviewListResponse { List<ReviewSummary> reviews }
- GET /api/review/{id} â†’ ReviewResponse
```

### 4. DTO ê³„ì¸µ êµ¬ì¡°
```
XxxResponseDto.java (ì™¸ë¶€ í´ë˜ìŠ¤)
  â”œâ”€ public record DetailResponse (ë‹¨ì¼ ìƒì„¸)
  â”œâ”€ public record SummaryResponse (ëª©ë¡ìš© ìš”ì•½)
  â””â”€ public record ListResponse (ëª©ë¡ + ë©”íƒ€ë°ì´í„°)
       â””â”€ List<SummaryResponse> items
       â””â”€ int totalCount
       â””â”€ PaginationInfo pagination (í•„ìš” ì‹œ)
```

---

## ğŸ“¦ ì‹ ê·œ DTO

### 1. WishlistResponseDto

#### 1.1 WishlistItem (ì°œ ëª©ë¡ìš©)
```
ìš©ë„: ì°œ ëª©ë¡ ì¡°íšŒ ì‹œ ì‚¬ìš©
ê²½ë¡œ: GET /api/user/wishlists

public record WishlistItem(
    UUID wishlistId,
    UUID menuId,
    String serviceName,
    Integer price,
    Integer durationMinutes,
    String imageUrl,
    UUID businessId,
    String businessName,
    LocalDateTime createdAt
)
```

#### 1.2 WishlistListResponse (ì°œ ëª©ë¡ ì‘ë‹µ)
```
ìš©ë„: ì°œ ëª©ë¡ ì „ì²´ ì‘ë‹µ
ê²½ë¡œ: GET /api/user/wishlists

public record WishlistListResponse(
    List<WishlistItem> wishlists,
    int totalCount
)
```

#### 1.3 WishlistActionResponse (ì°œ ì¶”ê°€/ì‚­ì œ ì‘ë‹µ)
```
ìš©ë„: ì°œ ì¶”ê°€/ì‚­ì œ ì‹œ ì‚¬ìš©
ê²½ë¡œ: POST /api/user/wishlist, DELETE /api/user/wishlist/{menuId}

public record WishlistActionResponse(
    UUID menuId,
    boolean isWishlisted,  // true: ì¶”ê°€ë¨, false: ì‚­ì œë¨
    String message
)
```

---

### 2. WishlistRequestDto

#### 2.1 AddWishlistRequest (ì°œ ì¶”ê°€)
```
ìš©ë„: ì°œ ì¶”ê°€
ê²½ë¡œ: POST /api/user/wishlist

public record AddWishlistRequest(
    @NotNull
    UUID menuId
)
```

**ê²€ì¦ ê·œì¹™**:
- menuId: í•„ìˆ˜, ì¡´ì¬í•˜ëŠ” Menuì—¬ì•¼ í•¨

---

### 3. ReviewResponseDto

#### 3.1 ReviewResponse (ë¦¬ë·° ìƒì„¸)
```
ìš©ë„: ë¦¬ë·° ë‹¨ì¼ ì¡°íšŒ
ê²½ë¡œ: GET /api/review/{id}

public record ReviewResponse(
    UUID reviewId,
    UUID businessId,
    String businessName,
    UUID userId,
    String userName,
    String userProfileImage,
    UUID reservationId,
    String menuName,  // ìŠ¤ëƒ…ìƒ·
    Integer rating,   // 1~5
    String comment,
    LocalDateTime createdAt,
    LocalDateTime updatedAt
)
```

#### 3.2 ReviewSummary (ë¦¬ë·° ëª©ë¡ìš©)
```
ìš©ë„: ë¦¬ë·° ëª©ë¡ ì¡°íšŒ
ê²½ë¡œ: GET /api/business/{id}/reviews

public record ReviewSummary(
    UUID reviewId,
    UUID userId,
    String userName,
    String userProfileImage,
    String menuName,
    Integer rating,
    String comment,  // ì²« 100ìë§Œ (í”„ë¡ íŠ¸ì—ì„œ ì²˜ë¦¬)
    LocalDateTime createdAt
)
```

#### 3.3 ReviewListResponse (ë¦¬ë·° ëª©ë¡ ì‘ë‹µ)
```
ìš©ë„: ì—…ì²´ë³„ ë¦¬ë·° ëª©ë¡
ê²½ë¡œ: GET /api/business/{id}/reviews

public record ReviewListResponse(
    ReviewStatistics statistics,
    List<ReviewSummary> reviews,
    int totalCount,
    PaginationInfo pagination
)

public record ReviewStatistics(
    Double averageRating,
    int totalReviews,
    Map<Integer, Integer> ratingDistribution  // {5: 10ê°œ, 4: 5ê°œ, ...}
)
```

#### 3.4 MyReviewListResponse (ë‚´ê°€ ì‘ì„±í•œ ë¦¬ë·° ëª©ë¡)
```
ìš©ë„: ë‚´ê°€ ì‘ì„±í•œ ë¦¬ë·° ëª©ë¡
ê²½ë¡œ: GET /api/user/reviews

public record MyReviewListResponse(
    List<MyReviewItem> reviews,
    int totalCount
)

public record MyReviewItem(
    UUID reviewId,
    UUID businessId,
    String businessName,
    String menuName,
    Integer rating,
    String comment,
    LocalDateTime createdAt
)
```

---

### 4. ReviewRequestDto

#### 4.1 CreateReviewRequest (ë¦¬ë·° ì‘ì„±)
```
ìš©ë„: ë¦¬ë·° ì‘ì„±
ê²½ë¡œ: POST /api/review

public record CreateReviewRequest(
    @NotNull
    UUID reservationId,
    
    @NotNull
    @Min(1) @Max(5)
    Integer rating,
    
    @Size(max = 1000)
    String comment
)
```

**ê²€ì¦ ê·œì¹™**:
- reservationId: í•„ìˆ˜, COMPLETED ìƒíƒœì˜ ì˜ˆì•½
- rating: í•„ìˆ˜, 1~5 ì‚¬ì´
- comment: ì„ íƒ, ìµœëŒ€ 1000ì

#### 4.2 UpdateReviewRequest (ë¦¬ë·° ìˆ˜ì •)
```
ìš©ë„: ë¦¬ë·° ìˆ˜ì •
ê²½ë¡œ: PUT /api/review/{id}

public record UpdateReviewRequest(
    @NotNull
    @Min(1) @Max(5)
    Integer rating,
    
    @Size(max = 1000)
    String comment
)
```

---

### 5. UserResponseDto (í™•ì¥)

#### 5.1 UserProfileResponse (í”„ë¡œí•„ ì¡°íšŒ)
```
ìš©ë„: ê³ ê° í”„ë¡œí•„ ì¡°íšŒ
ê²½ë¡œ: GET /api/user/profile

public record UserProfileResponse(
    UUID userId,
    String email,
    String name,
    String phoneNumber,
    String profileImageUrl,
    LocalDateTime createdAt,
    LocalDateTime lastLoginAt,
    
    // í†µê³„ ì •ë³´
    int totalReservations,
    int completedReservations,
    int wishlistCount,
    int reviewCount
)
```

---

### 6. UserRequestDto (ì‹ ê·œ)

#### 6.1 UpdateProfileRequest (í”„ë¡œí•„ ìˆ˜ì •)
```
ìš©ë„: í”„ë¡œí•„ ìˆ˜ì •
ê²½ë¡œ: PUT /api/user/profile

public record UpdateProfileRequest(
    @Size(min = 2, max = 50)
    String name,
    
    @Pattern(regexp = "^01[0-9]{8,9}$")
    String phoneNumber,
    
    @URL
    String profileImageUrl
)
```

**ê²€ì¦ ê·œì¹™**:
- ëª¨ë“  í•„ë“œ ì„ íƒ (null ê°€ëŠ¥)
- name: 2~50ì
- phoneNumber: íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹
- profileImageUrl: URL í˜•ì‹

#### 6.2 ChangePasswordRequest (ë¹„ë°€ë²ˆí˜¸ ë³€ê²½)
```
ìš©ë„: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
ê²½ë¡œ: POST /api/user/passwordchange

public record ChangePasswordRequest(
    @NotBlank
    String currentPassword,
    
    @NotBlank
    @Size(min = 8, max = 20)
    @Pattern(regexp = "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,20}$")
    String newPassword,
    
    @NotBlank
    String newPasswordConfirm
)
```

**ê²€ì¦ ê·œì¹™**:
- currentPassword: í•„ìˆ˜
- newPassword: 8~20ì, ëŒ€ì†Œë¬¸ì+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì í¬í•¨
- newPasswordConfirm: newPasswordì™€ ì¼ì¹˜í•´ì•¼ í•¨

---

## ğŸ”„ ê¸°ì¡´ DTO í™œìš©

### 1. Business (ê¸°ì¡´ í™œìš©)

#### 1.1 PublicBusinessResponse (ì´ë¯¸ ì¡´ì¬ - ìˆ˜ì • í•„ìš”)
```
ìš©ë„: ê³ ê°ìš© ì—…ì²´ ìƒì„¸ ì¡°íšŒ
ê²½ë¡œ: GET /api/business/{id}

ì¶”ê°€ í•„ë“œ:
- Double averageRating
- Integer reviewCount
- String businessNotice (ê³ ê°ìš© ê³µì§€)
```

#### 1.2 BusinessListResponse (ê²€ìƒ‰ ê²°ê³¼)
```
ìš©ë„: ì—…ì²´ ê²€ìƒ‰
ê²½ë¡œ: GET /api/business/search

ì´ë¯¸ ì¡´ì¬ - ê·¸ëŒ€ë¡œ ì‚¬ìš©
```

---

### 2. Menu (ê¸°ì¡´ í™œìš©)

#### 2.1 Menu (ë‹¨ì¼ ìƒì„¸)
```
ìš©ë„: ë©”ë‰´ ìƒì„¸ ì¡°íšŒ
ê²½ë¡œ: GET /api/business/{id}/menu/{menuId}

ì´ë¯¸ ì¡´ì¬ - ê·¸ëŒ€ë¡œ ì‚¬ìš©
```

#### 2.2 MenuList (ëª©ë¡)
```
ìš©ë„: ì—…ì²´ë³„ ë©”ë‰´ ëª©ë¡
ê²½ë¡œ: GET /api/business/{id}/menu

ì´ë¯¸ ì¡´ì¬ - ê·¸ëŒ€ë¡œ ì‚¬ìš©
```

---

### 3. Reservation (ê¸°ì¡´ í™œìš©)

#### 3.1 CustomerReservation (ë‹¨ì¼ ìƒì„¸)
```
ìš©ë„: ì˜ˆì•½ ìƒì„¸ ì¡°íšŒ
ê²½ë¡œ: GET /api/reservation/{id}

ì´ë¯¸ ì¡´ì¬ - ê·¸ëŒ€ë¡œ ì‚¬ìš©
```

#### 3.2 CustomerReservationList (ëª©ë¡)
```
ìš©ë„: ë‚´ ì˜ˆì•½ ëª©ë¡
ê²½ë¡œ: GET /api/reservations

ì´ë¯¸ ì¡´ì¬ - ê·¸ëŒ€ë¡œ ì‚¬ìš©
```

#### 3.3 CreateReservationRequest (ì˜ˆì•½ ìƒì„±)
```
ìš©ë„: ì˜ˆì•½ ìƒì„±
ê²½ë¡œ: POST /api/reservation

ì´ë¯¸ ì¡´ì¬ - ê·¸ëŒ€ë¡œ ì‚¬ìš©
```

---

## ğŸ“Š DTO ë³€í™˜ ê·œì¹™

### 1. Entity â†’ Response DTO

#### ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ ì‚¬ìš©
```
public record ReviewResponse(...) {
    public static ReviewResponse from(Review entity) {
        return new ReviewResponse(
            entity.getId(),
            entity.getBusiness().getId(),
            entity.getBusiness().getBusinessName(),
            entity.getUser().getId(),
            entity.getUser().getName(),
            entity.getUser().getProfileImageUrl(),
            entity.getReservation() != null ? entity.getReservation().getId() : null,
            entity.getMenuName(),  // ìŠ¤ëƒ…ìƒ·
            entity.getRating(),
            entity.getComment(),
            entity.getCreatedAt(),
            entity.getUpdatedAt()
        );
    }
}
```

#### Serviceì—ì„œ ë³€í™˜
```
@Service
public class ReviewQueryService {
    public ReviewResponse getReview(UUID reviewId) {
        Review review = reviewRepository.findById(reviewId)...;
        return ReviewResponse.from(review);
    }
}
```

---

### 2. Request DTO â†’ Service ê³„ì¸µ

#### Service ë©”ì„œë“œì— ì§ì ‘ ì „ë‹¬
```
@Service
public class ReviewCommandService {
    public ReviewResponse createReview(
        CreateReviewRequest request, 
        UUID userId
    ) {
        // Validation
        Reservation reservation = validateReservation(request.reservationId(), userId);
        
        // Entity ìƒì„±
        Review review = Review.create(
            reservation.getBusiness(),
            reservation.getCustomer(),
            reservation,
            reservation.getMenu().getServiceName(),  // ìŠ¤ëƒ…ìƒ·
            request.rating(),
            request.comment()
        );
        
        reviewRepository.save(review);
        return ReviewResponse.from(review);
    }
}
```

---

## ğŸ” DTO ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ì°œ ëª©ë¡ ì¡°íšŒ

**Request**:
```
GET /api/user/wishlists
```

**Response**:
```json
{
  "success": true,
  "data": {
    "wishlists": [
      {
        "wishlistId": "uuid1",
        "menuId": "uuid2",
        "serviceName": "í—¤ì–´ ì»·",
        "price": 30000,
        "durationMinutes": 60,
        "imageUrl": "https://...",
        "businessId": "uuid3",
        "businessName": "ê°•ë‚¨ í—¤ì–´ìƒµ",
        "createdAt": "2025-01-20T10:00:00"
      }
    ],
    "totalCount": 1
  }
}
```

---

### ì˜ˆì‹œ 2: ë¦¬ë·° ì‘ì„±

**Request**:
```
POST /api/review
Content-Type: application/json

{
  "reservationId": "uuid1",
  "rating": 5,
  "comment": "ì •ë§ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ì„œë¹„ìŠ¤ì˜€ìŠµë‹ˆë‹¤!"
}
```

**Response**:
```json
{
  "success": true,
  "data": {
    "reviewId": "uuid2",
    "businessId": "uuid3",
    "businessName": "ê°•ë‚¨ í—¤ì–´ìƒµ",
    "userId": "uuid4",
    "userName": "í™ê¸¸ë™",
    "userProfileImage": "https://...",
    "reservationId": "uuid1",
    "menuName": "í—¤ì–´ ì»·",
    "rating": 5,
    "comment": "ì •ë§ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ì„œë¹„ìŠ¤ì˜€ìŠµë‹ˆë‹¤!",
    "createdAt": "2025-01-30T15:00:00",
    "updatedAt": "2025-01-30T15:00:00"
  }
}
```

---

### ì˜ˆì‹œ 3: í”„ë¡œí•„ ìˆ˜ì •

**Request**:
```
PUT /api/user/profile
Content-Type: application/json

{
  "name": "ê¹€ì² ìˆ˜",
  "phoneNumber": "01012345678"
}
```

**Response**:
```json
{
  "success": true,
  "data": {
    "userId": "uuid1",
    "email": "user@example.com",
    "name": "ê¹€ì² ìˆ˜",
    "phoneNumber": "01012345678",
    "profileImageUrl": "https://...",
    "createdAt": "2025-01-01T00:00:00",
    "lastLoginAt": "2025-01-30T15:00:00",
    "totalReservations": 10,
    "completedReservations": 8,
    "wishlistCount": 5,
    "reviewCount": 3
  }
}
```

---

## ğŸ“‹ DTO ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì‹ ê·œ ì‘ì„± í•„ìš”
- [x] WishlistResponseDto
- [x] WishlistRequestDto
- [x] ReviewResponseDto
- [x] ReviewRequestDto
- [x] UserRequestDto (í”„ë¡œí•„ ìˆ˜ì •, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½)

### ê¸°ì¡´ í™•ì¥ í•„ìš”
- [ ] UserResponseDto (UserProfileResponse ì¶”ê°€)
- [ ] BusinessResponseDto.PublicBusinessResponse (í‰ì  í•„ë“œ ì¶”ê°€)

### ê¸°ì¡´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
- [x] BusinessResponseDto (ê²€ìƒ‰)
- [x] MenuResponseDto
- [x] ReservationResponseDto
- [x] ReservationRequestDto

---

## ğŸ¨ ë„¤ì´ë° ì¼ê´€ì„± ê²€ì¦

| ì—”ë“œí¬ì¸íŠ¸ | DTO ì´ë¦„ | ë³µìˆ˜í˜• ê·œì¹™ | âœ… |
|-----------|---------|-----------|---|
| GET /api/user/wishlists | WishlistListResponse | wishlists | âœ… |
| POST /api/user/wishlist | AddWishlistRequest | - | âœ… |
| GET /api/business/{id}/reviews | ReviewListResponse | reviews | âœ… |
| POST /api/review | CreateReviewRequest | - | âœ… |
| GET /api/reservations | CustomerReservationList | reservations | âœ… |
| GET /api/business/{id}/menu | MenuList | menus | âœ… |

---

## ğŸ“ ê°œë°œ ì°¸ê³ ì‚¬í•­

### Validation ì• ë„ˆí…Œì´ì…˜
```
@NotNull - í•„ìˆ˜ í•„ë“œ
@NotBlank - ë¬¸ìì—´ í•„ìˆ˜ (ê³µë°± ë¶ˆí—ˆ)
@Size(min=, max=) - ë¬¸ìì—´ ê¸¸ì´
@Min, @Max - ìˆ«ì ë²”ìœ„
@Pattern - ì •ê·œì‹ ê²€ì¦
@Email - ì´ë©”ì¼ í˜•ì‹
@URL - URL í˜•ì‹
```

### ê³µí†µ Response êµ¬ì¡°
```
ëª¨ë“  API ì‘ë‹µì€ ResponseDataë¡œ ë˜í•‘:

{
  "success": true/false,
  "data": { ... },
  "error": { ... }  // ì—ëŸ¬ ì‹œì—ë§Œ
}
```

### í˜ì´ì§€ë„¤ì´ì…˜ (í•„ìš” ì‹œ)
```
public record PaginationInfo(
    int currentPage,
    int pageSize,
    int totalPages,
    long totalElements
)
```